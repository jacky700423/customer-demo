import{au as pe,c as r,ar as Q,m as f,al as W,M as Y,aa as P,af as me,aC as _e,Z as we,_ as ye,ac as ge,bg as F,ak as he,bh as Ce,bi as be,v as ke,at as xe,as as Te,aA as Ee}from"./ui-B8MTJjzS.js";import{t as y}from"./page-auth-B067K4bE.js";import{a as Le}from"./page-files-Cwuz-WAk.js";import{aY as Ve,bg as c,b2 as T,br as K,aZ as u,a_ as n,a$ as l,b0 as a,bs as ze,b9 as X,bc as e,b1 as o,bb as v,bk as g,b5 as S,b8 as Pe,ba as Fe,bn as Se}from"./vendor-other-DMrNeO-R.js";import{_ as Ue}from"./page-admin-Txqa2T3a.js";import"./utils-nO-s2RVl.js";import"./vendor-C-KThoNQ.js";import"./page-dashboard-DWJ9bqym.js";const je={class:"file-preview"},De={class:"preview-header"},Be=["id"],Ie={class:"preview-actions"},Me={class:"preview-content"},Ne={key:0,class:"image-preview"},$e={key:1,class:"pdf-preview"},qe=["src"],Ae={key:2,class:"video-preview"},He=["src"],Re={key:3,class:"audio-preview"},Je={class:"audio-info"},Oe=["src"],Ze={key:4,class:"text-preview"},Ge={class:"text-content"},Qe={key:5,class:"code-preview"},We={class:"code-header"},Ye={class:"language-tag"},Ke={class:"code-content"},Xe={key:6,class:"office-preview"},el={class:"office-info"},ll={class:"office-actions"},tl={key:7,class:"unsupported-preview"},al={class:"unsupported-info"},sl={key:8,class:"preview-error"},ol=Ve({__name:"FilePreview",props:{modelValue:{type:Boolean},file:{},baseUrl:{default:"/api/files"}},emits:["update:modelValue","close","download"],setup(d,{emit:ee}){const i=d,U=ee,le=Le(),{formatFileSize:j}=le,b=c({get:()=>i.modelValue,set:t=>U("update:modelValue",t)}),D=T(!1),h=T(!1),m=T(""),k=T(""),_=T(!1),te=c(()=>_.value?"100%":I.value||M.value?"80%":E.value?"90%":"60%"),w=c(()=>i.file?i.file.url:""),ae=c(()=>!i.file||!E.value?"":`${w.value}#toolbar=1&navpanes=1&scrollbar=1`),B=c(()=>!i.file||!N.value?"":`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(w.value)}`),I=c(()=>i.file?["jpg","jpeg","png","gif","bmp","webp","svg"].includes(p().toLowerCase()):!1),E=c(()=>p().toLowerCase()==="pdf"),M=c(()=>["mp4","avi","mov","wmv","flv","webm","mkv"].includes(p().toLowerCase())),q=c(()=>["mp3","wav","ogg","aac","flac","m4a"].includes(p().toLowerCase())),A=c(()=>["txt","md","json","xml","csv","log"].includes(p().toLowerCase())),H=c(()=>["js","ts","vue","html","css","scss","less","php","py","java","cpp","c","go","rs","sql"].includes(p().toLowerCase())),N=c(()=>["doc","docx","xls","xlsx","ppt","pptx"].includes(p().toLowerCase())),p=()=>{var t;return(t=i.file)!=null&&t.name&&i.file.name.split(".").pop()||""},se=()=>I.value?xe:E.value||N.value?Y:M.value?Te:q.value?Q:Ee,oe=()=>{const t=p().toLowerCase();return{js:"JavaScript",ts:"TypeScript",vue:"Vue",html:"HTML",css:"CSS",scss:"SCSS",less:"Less",php:"PHP",py:"Python",java:"Java",cpp:"C++",c:"C",go:"Go",rs:"Rust",sql:"SQL"}[t]||t.toUpperCase()},ie=()=>{b.value=!1,U("close"),Se(()=>{m.value="",k.value="",_.value=!1})},ne=()=>{_.value=!_.value},L=async()=>{if(i.file){h.value=!0;try{const t=i.file.downloadUrl||i.file.url,s=document.createElement("a");s.href=t,s.download=i.file.name,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s),U("download",i.file),y.success("檔案下載已開始")}catch(t){console.error("Download error:",t),y.error("檔案下載失敗")}finally{h.value=!1}}},re=()=>{i.file&&y.success("分享功能開發中")},ce=async()=>{if(i.file)try{await navigator.clipboard.writeText(i.file.url),y.success("檔案連結已複製到剪貼板")}catch(t){console.error("Copy error:",t),y.error("複製失敗")}},ue=()=>{B.value&&window.open(B.value,"_blank")},de=async()=>{try{await navigator.clipboard.writeText(k.value),y.success("代碼已複製到剪貼板")}catch(t){console.error("Copy error:",t),y.error("複製失敗")}},V=()=>{m.value="檔案預覽失敗，請檢查檔案是否存在或網絡連接"},fe=()=>{m.value="",$()},$=async()=>{if(i.file){D.value=!0,m.value="";try{if(A.value||H.value){const t=await fetch(w.value,{headers:{Accept:"text/plain, text/*, */*"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.text();k.value=s}}catch(t){console.error("Preview loading error:",t),m.value="載入預覽內容失敗"}finally{D.value=!1}}};return K(()=>i.file,t=>{t&&b.value&&$()},{immediate:!0}),K(b,t=>{t&&i.file&&$()}),(t,s)=>{var R;const ve=ge;return n(),u("div",je,[l(e(ke),{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=C=>b.value=C),title:((R=d.file)==null?void 0:R.name)||"檔案預覽",width:te.value,fullscreen:_.value,"before-close":ie,class:"file-preview-dialog","append-to-body":""},{header:a(({titleId:C,titleClass:z})=>{var x;return[o("div",De,[o("h4",{id:C,class:Pe(z)},[l(e(r),{class:"file-type-icon"},{default:a(()=>[(n(),S(Fe(se())))]),_:1}),g(" "+v(((x=d.file)==null?void 0:x.name)||"檔案預覽"),1)],10,Be),o("div",Ie,[l(e(F),{content:"分享檔案"},{default:a(()=>[l(e(f),{size:"small",circle:"",onClick:re},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(he))]),_:1})]),_:1})]),_:1}),l(e(F),{content:"複製連結"},{default:a(()=>[l(e(f),{size:"small",circle:"",onClick:ce},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(W))]),_:1})]),_:1})]),_:1}),l(e(F),{content:"下載檔案"},{default:a(()=>[l(e(f),{type:"primary",size:"small",circle:"",onClick:L,loading:h.value},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(P))]),_:1})]),_:1},8,["loading"])]),_:1}),l(e(F),{content:_.value?"退出全屏":"全屏預覽"},{default:a(()=>[l(e(f),{type:"info",size:"small",circle:"",onClick:ne},{default:a(()=>[l(e(r),null,{default:a(()=>[_.value?(n(),S(e(be),{key:1})):(n(),S(e(Ce),{key:0}))]),_:1})]),_:1})]),_:1},8,["content"])])])]}),default:a(()=>{var C,z,x,J,O,Z,G;return[ze((n(),u("div",Me,[I.value?(n(),u("div",Ne,[l(e(pe),{src:w.value,alt:(C=d.file)==null?void 0:C.name,fit:"contain","preview-src-list":[w.value],"initial-index":0,"hide-on-click-modal":!0,class:"preview-image",onError:V},null,8,["src","alt","preview-src-list"])])):E.value?(n(),u("div",$e,[o("iframe",{src:ae.value,class:"pdf-iframe",onError:V},null,40,qe)])):M.value?(n(),u("div",Ae,[o("video",{src:w.value,controls:"",class:"preview-video",onError:V}," 您的瀏覽器不支持視頻播放 ",40,He)])):q.value?(n(),u("div",Re,[o("div",Je,[l(e(r),{class:"audio-icon",size:64},{default:a(()=>[l(e(Q))]),_:1}),o("h3",null,v((z=d.file)==null?void 0:z.name),1),o("p",null,v(e(j)(((x=d.file)==null?void 0:x.size)||0)),1)]),o("audio",{src:w.value,controls:"",class:"preview-audio",onError:V}," 您的瀏覽器不支持音頻播放 ",40,Oe)])):A.value?(n(),u("div",Ze,[o("pre",Ge,v(k.value),1)])):H.value?(n(),u("div",Qe,[o("div",We,[o("span",Ye,v(oe()),1),l(e(f),{size:"small",type:"primary",text:"",onClick:de},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(W))]),_:1}),s[1]||(s[1]=g(" 複製代碼 ",-1))]),_:1})]),o("pre",Ke,[o("code",null,v(k.value),1)])])):N.value?(n(),u("div",Xe,[o("div",el,[l(e(r),{class:"office-icon",size:64},{default:a(()=>[l(e(Y))]),_:1}),o("h3",null,v((J=d.file)==null?void 0:J.name),1),o("p",null,v(e(j)(((O=d.file)==null?void 0:O.size)||0)),1),s[2]||(s[2]=o("p",{class:"office-hint"}," 此類型檔案需要下載後使用相應軟件打開 ",-1))]),o("div",ll,[l(e(f),{type:"primary",onClick:L,loading:h.value},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(P))]),_:1}),s[3]||(s[3]=g(" 下載檔案 ",-1))]),_:1},8,["loading"]),B.value?(n(),S(e(f),{key:0,type:"info",onClick:ue},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(me))]),_:1}),s[4]||(s[4]=g(" 在線預覽 ",-1))]),_:1})):X("",!0)])])):(n(),u("div",tl,[o("div",al,[l(e(r),{class:"unsupported-icon",size:64},{default:a(()=>[l(e(_e))]),_:1}),s[5]||(s[5]=o("h3",null,"無法預覽此檔案",-1)),o("p",null,v((Z=d.file)==null?void 0:Z.name),1),o("p",null,v(e(j)(((G=d.file)==null?void 0:G.size)||0)),1),s[6]||(s[6]=o("p",{class:"unsupported-hint"}," 此檔案類型暫不支持預覽，請下載後查看 ",-1))]),l(e(f),{type:"primary",onClick:L,loading:h.value},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(P))]),_:1}),s[7]||(s[7]=g(" 下載檔案 ",-1))]),_:1},8,["loading"])])),m.value?(n(),u("div",sl,[l(e(we),{icon:"error",title:"預覽失敗","sub-title":m.value},{extra:a(()=>[l(e(f),{type:"primary",onClick:fe},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(ye))]),_:1}),s[8]||(s[8]=g(" 重試 ",-1))]),_:1}),l(e(f),{onClick:L,loading:h.value},{default:a(()=>[l(e(r),null,{default:a(()=>[l(e(P))]),_:1}),s[9]||(s[9]=g(" 下載檔案 ",-1))]),_:1},8,["loading"])]),_:1},8,["sub-title"])])):X("",!0)])),[[ve,D.value]])]}),_:1},8,["modelValue","title","width","fullscreen"])])}}}),pl=Ue(ol,[["__scopeId","data-v-a362dbed"]]);export{pl as default};
