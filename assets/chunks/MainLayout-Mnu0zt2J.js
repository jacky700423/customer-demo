import{H as F,r as A,J as D,aA as H,W as _e,b3 as pe,b4 as me,b5 as fe,c as he,b6 as ge,b7 as be,m as ve,aF as ye,b8 as ke,a4 as we,a3 as xe,T as Ce,U,b9 as Ee,ba as Me,ag as Se,aW as Be,aL as De,ai as Ie,aj as Ne,u as Te,aK as Y,bb as ze,bc as Ae,bd as Le,be as Ve,a2 as je,o as y}from"./ui-B8MTJjzS.js";import{aY as qe,b2 as T,bg as S,b3 as Ue,br as Ye,bi as Fe,aZ as u,a_ as s,a$ as a,b0 as e,b1 as r,b6 as k,b7 as B,b5 as c,bk as m,bb as d,b9 as w,ba as z,bc as n,bO as He,b8 as Re}from"./vendor-other-DMrNeO-R.js";import{a as $e,u as We,b as Je}from"./vendor-C-KThoNQ.js";import{u as Ke}from"./page-auth-B067K4bE.js";import{u as Oe,a as Ze}from"./page-dashboard-DWJ9bqym.js";import{d as Ge}from"./utils-nO-s2RVl.js";import{_ as Pe}from"./page-admin-Txqa2T3a.js";const Qe=[{title:"儀表板",path:"/dashboard",icon:F},{title:"物件管理",path:"/objects",icon:A},{title:"機會管理",path:"/opportunities",icon:D,children:[{title:"機會列表",path:"/opportunities"},{title:"投資者管理",path:"/opportunities/investors"}]},{title:"檔案管理",path:"/files",icon:H}],Xe=[{title:"每日計畫",path:"/dashboard",icon:F},{title:"物件開發",path:"/objects/dev",icon:A},{title:"可流通物件",path:"/objects",icon:A,query:{status:"available"}},{title:"商機管理",path:"/opportunities",icon:D},{title:"成交紀錄",path:"/opportunities",icon:D,query:{status:"completed"}},{title:"績效管理",path:"/performance",icon:D},{title:"行政業務",path:"/admin",icon:H},{title:"物件刪除",path:"/objects",icon:_e}],et={class:"main-layout"},tt={class:"sidebar-header"},at={key:0,class:"logo"},ot={key:1,class:"logo-collapsed"},st={class:"header-left"},nt={class:"header-right"},lt={class:"user-info"},rt={key:0,class:"username"},it={class:"notifications-container"},ut={key:0,class:"empty-state"},ct={class:"notification-content"},dt={class:"notification-time"},_t=qe({__name:"MainLayout",setup(pt){const I=$e(),x=We(),g=Ke(),b=Oe(),v=Ze(),{t:f}=Je(),_=T(!1),h=T(!1),C=T(!1),R=S(()=>{const l=I.path;return l.startsWith("/opportunities")?"/opportunities":l}),$=S(()=>v.legacyMode?Xe:Qe),W=S(()=>I.matched.filter(o=>o.meta&&o.meta.title).map(o=>({path:o.path,title:o.meta.title}))),L=S(()=>b.unreadNotifications.length),V=l=>{l.query?x.push({path:l.path,query:l.query}):x.push(l.path)},J=()=>{_.value=!_.value,localStorage.setItem("sidebarCollapsed",String(_.value))},K=()=>{h.value=!h.value,document.documentElement.classList.toggle("dark",h.value),localStorage.setItem("theme",h.value?"dark":"light")},O=()=>{C.value=!0},Z=async l=>{switch(l){case"profile":x.push("/profile");break;case"settings":y.info(f("messages.settings_wip"));break;case"toggle-legacy":v.setLegacyMode(!v.legacyMode),y.success(v.legacyMode?f("user.toggle_legacy_on"):f("user.toggle_legacy_off"));break;case"logout":try{await je.confirm(f("common.confirm_logout"),f("user.logout"),{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),await g.logout(),y.success(f("messages.logout_success")),x.push("/login")}catch{}break}},G=async l=>{try{await b.markNotificationAsRead(l),y.success("已標記為已讀")}catch{y.error("標記失敗")}},P=l=>Ge(l).format("YYYY-MM-DD HH:mm");return Ue(async()=>{const l=localStorage.getItem("sidebarCollapsed");l&&(_.value=l==="true");const o=localStorage.getItem("theme");if(o&&(h.value=o==="dark",document.documentElement.classList.toggle("dark",h.value)),!g.user)try{await g.fetchUser()}catch(i){console.error("Failed to fetch user info:",i)}try{await b.fetchNotifications()}catch(i){console.error("Failed to fetch notifications:",i)}}),Ye(()=>I.path,()=>{C.value=!1}),(l,o)=>{const i=he,j=fe,Q=me,X=pe,ee=ge,E=ve,te=xe,ae=we,oe=Ce,se=Be,M=Ne,ne=Ie,le=Se,re=be,ie=Fe("router-view"),ue=Ae,ce=Le,de=Ve;return s(),u("div",et,[a(ee,{width:_.value?"64px":"240px",class:"sidebar"},{default:e(()=>[r("div",tt,[_.value?(s(),u("div",ot,[...o[2]||(o[2]=[r("span",null,"長",-1)])])):(s(),u("div",at,[...o[1]||(o[1]=[r("h2",null,"長拓不動產",-1)])]))]),a(X,{"default-active":R.value,collapse:_.value,"unique-opened":!0,router:"",class:"sidebar-menu"},{default:e(()=>[(s(!0),u(k,null,B($.value,t=>(s(),u(k,{key:t.title},[t.children&&t.children.length?(s(),c(Q,{key:0,index:t.path},{title:e(()=>[t.icon?(s(),c(i,{key:0},{default:e(()=>[(s(),c(z(t.icon)))]),_:2},1024)):w("",!0),r("span",null,d(t.title),1)]),default:e(()=>[(s(!0),u(k,null,B(t.children,p=>(s(),c(j,{key:p.title,index:p.path,onClick:N=>V(p)},{default:e(()=>[m(d(p.title),1)]),_:2},1032,["index","onClick"]))),128))]),_:2},1032,["index"])):(s(),c(j,{key:1,index:t.path,onClick:p=>V(t)},{title:e(()=>[m(d(t.title),1)]),default:e(()=>[t.icon?(s(),c(i,{key:0},{default:e(()=>[(s(),c(z(t.icon)))]),_:2},1024)):w("",!0)]),_:2},1032,["index","onClick"]))],64))),128))]),_:1},8,["default-active","collapse"])]),_:1},8,["width"]),a(ce,{class:"main-container"},{default:e(()=>[a(re,{class:"header"},{default:e(()=>[r("div",st,[a(E,{icon:_.value?n(ye):n(ke),onClick:J,text:"",size:"large"},null,8,["icon"]),a(ae,{separator:"/"},{default:e(()=>[(s(!0),u(k,null,B(W.value,t=>(s(),c(te,{key:t.path,to:t.path},{default:e(()=>[m(d(t.title),1)]),_:2},1032,["to"]))),128))]),_:1})]),r("div",nt,[a(oe,{value:L.value,hidden:L.value===0},{default:e(()=>[a(E,{icon:n(U),text:"",size:"large",onClick:O},null,8,["icon"])]),_:1},8,["value","hidden"]),a(E,{icon:h.value?n(Ee):n(Me),onClick:K,text:"",size:"large"},null,8,["icon"]),a(le,{onCommand:Z,"data-testid":"user-menu"},{dropdown:e(()=>[a(ne,null,{default:e(()=>[a(M,{command:"profile"},{default:e(()=>[a(i,null,{default:e(()=>[a(n(Te))]),_:1}),o[3]||(o[3]=m(" 個人資料 ",-1))]),_:1}),a(M,{command:"settings"},{default:e(()=>[a(i,null,{default:e(()=>[a(n(Y))]),_:1}),o[4]||(o[4]=m(" 系統設定 ",-1))]),_:1}),a(M,{divided:"",command:"toggle-legacy"},{default:e(()=>[a(i,null,{default:e(()=>[a(n(Y))]),_:1}),m(" "+d(n(v).legacyMode?n(f)("user.toggle_legacy_off"):n(f)("user.toggle_legacy_on")),1)]),_:1}),a(M,{divided:"",command:"logout","data-testid":"logout-button"},{default:e(()=>[a(i,null,{default:e(()=>[a(n(ze))]),_:1}),o[5]||(o[5]=m(" 登出 ",-1))]),_:1})]),_:1})]),default:e(()=>{var t,p;return[r("div",lt,[a(se,{size:32,src:(t=n(g).user)==null?void 0:t.avatar},{default:e(()=>{var N,q;return[m(d((q=(N=n(g).user)==null?void 0:N.name)==null?void 0:q.charAt(0)),1)]}),_:1},8,["src"]),_.value?w("",!0):(s(),u("span",rt,d((p=n(g).user)==null?void 0:p.name),1)),a(i,null,{default:e(()=>[a(n(De))]),_:1})])]}),_:1})])]),_:1}),a(ue,{class:"main-content"},{default:e(()=>[a(ie,null,{default:e(({Component:t})=>[a(He,{name:"fade",mode:"out-in"},{default:e(()=>[(s(),c(z(t)))]),_:2},1024)]),_:1})]),_:1})]),_:1}),a(de,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=t=>C.value=t),title:"系統通知",direction:"rtl",size:"400px"},{default:e(()=>[r("div",it,[n(b).notifications.length===0?(s(),u("div",ut,[a(i,{class:"empty-state-icon"},{default:e(()=>[a(n(U))]),_:1}),o[6]||(o[6]=r("p",{class:"empty-state-text"},"暫無通知",-1))])):w("",!0),(s(!0),u(k,null,B(n(b).notifications,t=>(s(),u("div",{key:t.id,class:Re(["notification-item",{unread:!t.read}])},[r("div",ct,[r("h4",null,d(t.title),1),r("p",null,d(t.content),1),r("span",dt,d(P(t.created_at)),1)]),t.read?w("",!0):(s(),c(E,{key:0,size:"small",onClick:p=>G(t.id)},{default:e(()=>[...o[7]||(o[7]=[m(" 標記已讀 ",-1)])]),_:1},8,["onClick"]))],2))),128))])]),_:1},8,["modelValue"])])}}}),kt=Pe(_t,[["__scopeId","data-v-17237e28"]]);export{kt as default};
