const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FilePreview-B-spa4Bs.js","assets/chunks/ui-B8MTJjzS.js","assets/chunks/vendor-other-DMrNeO-R.js","assets/chunks/utils-nO-s2RVl.js","assets/chunks/vendor-C-KThoNQ.js","assets/ui-hG_bPTIg.css","assets/chunks/page-auth-B067K4bE.js","assets/chunks/page-admin-Txqa2T3a.js","assets/page-admin-xTGGVsnG.css","assets/page-auth-CNFP2bWF.css","assets/chunks/page-dashboard-DWJ9bqym.js","assets/page-dashboard-DwmsIj7C.css","assets/FilePreview-B6TlW7In.css"])))=>i.map(i=>d[i]);
import{_ as Yt}from"./page-dashboard-DWJ9bqym.js";import{Z as Jt,m as Ce,c as Fe,_ as kt,$ as Kt,i as Ct,a0 as Qt,a1 as es,o as w,a2 as Me,a3 as ts,a4 as ss,a5 as as,j as st,G as Ft,F as xt,a6 as ls,a7 as os,a8 as ns,a9 as $t,aa as Ye,ab as Je,W as De,d as rs,ac as zt,k as is,ad as St,ae as je,af as _t,ag as cs,ah as gt,ai as us,aj as ds,ak as vt,al as yt,am as Qe,an as ht,ao as Et,ap as ps,aq as Ae,ar as at,as as lt,M as ot,at as et,au as nt,av as fs,aw as ms,ax as Mt,C as _s,D as gs,b as Dt,X as vs,ay as ys,n as Tt,h as Pt,az as hs,aA as ws,S as bs,aB as ks,v as Cs}from"./ui-B8MTJjzS.js";import{bg as L,aY as Se,aZ as P,a_ as c,bc as s,b8 as Oe,b1 as a,b9 as N,bm as Ie,bb as g,b2 as I,bq as Fs,bp as xs,a$ as e,b0 as t,b5 as U,bk as k,bn as $s,bh as Ut,br as Vt,b3 as rt,b4 as zs,bs as tt,b6 as _e,b7 as ge,ba as wt,bt as Ss,bl as Re}from"./vendor-other-DMrNeO-R.js";import{b as Te,u as it}from"./vendor-C-KThoNQ.js";import{_ as Ee}from"./page-admin-Txqa2T3a.js";import{u as Es,t as ze}from"./page-auth-B067K4bE.js";function ct(){const u=Es(),p=L(()=>u.userPermissions),n=L(()=>u.userRole),l=(D,F={})=>{const S=u.hasPermission(D);if(!S&&F.showError){const R=F.errorMessage||"您沒有權限執行此操作";ze.error(R,"權限不足")}return S},y=(D,F={})=>{const S=u.hasAnyPermission(D);if(!S&&F.showError){const R=F.errorMessage||"您沒有權限執行此操作";ze.error(R,"權限不足")}return S},h=(D,F={})=>{const S=u.hasAllPermissions(D);if(!S&&F.showError){const R=F.errorMessage||"您沒有權限執行此操作";ze.error(R,"權限不足")}return S},b=(D,F={})=>{const S=n.value===D;if(!S&&F.showError){const R=F.errorMessage||"您沒有權限執行此操作";ze.error(R,"權限不足")}return S},q=(D,F={})=>{const S=D.includes(n.value);if(!S&&F.showError){const R=F.errorMessage||"您沒有權限執行此操作";ze.error(R,"權限不足")}return S},E=(D,F,S={})=>((...R)=>l(D,S)?F(...R):null),$=(D,F,S={})=>((...R)=>b(D,S)?F(...R):null),H=D=>l(`${D}:view`),ee=D=>l(`${D}:create`),C=D=>l(`${D}:edit`),T=D=>l(`${D}:delete`),V=L(()=>b("admin")),A=L(()=>b("super_admin"));return{userPermissions:p,userRole:n,hasPermission:l,hasAnyPermission:y,hasAllPermissions:h,hasRole:b,hasAnyRole:q,withPermission:E,withRole:$,canView:H,canCreate:ee,canEdit:C,canDelete:T,isAdmin:V,isSuperAdmin:A}}const Ms=["aria-label"],Ds={class:"spinner-container"},Ts={key:0,class:"loading-text"},Ps=Se({__name:"LoadingSpinner",props:{size:{default:40},text:{default:void 0},fullScreen:{type:Boolean,default:!1}},setup(u){const{t:p}=Te();return(n,l)=>(c(),P("div",{class:Oe(["loading-spinner",{"full-screen":u.fullScreen}]),role:"status","aria-live":"polite","aria-busy":"true","aria-label":u.text||s(p)("common.loading")},[a("div",Ds,[a("div",{class:"spinner",style:Ie({width:u.size+"px",height:u.size+"px"})},[...l[0]||(l[0]=[a("div",{class:"spinner-inner"},null,-1)])],4),u.text||s(p)("common.loading")?(c(),P("div",Ts,g(u.text||s(p)("common.loading")),1)):N("",!0)])],10,Ms))}}),Us=Ee(Ps,[["__scopeId","data-v-399a1c63"]]),Vs={class:"error-boundary"},Bs={key:1,class:"error-container",role:"alert","aria-live":"assertive"},Rs={class:"error-actions"},Ls={class:"error-stack"},As=Se({__name:"ErrorBoundary",props:{fallbackTitle:{},fallbackMessage:{},showDetails:{type:Boolean},onError:{type:Function}},emits:["error","retry"],setup(u,{emit:p}){const{t:n}=Te(),l=u,y=L(()=>l.fallbackTitle??n("errors.page_error_title")),h=L(()=>l.fallbackMessage??n("errors.page_error_message")),b=L(()=>l.showDetails??!1),q=p,E=it(),$=I(!1),H=I(""),ee=I(""),C=I(""),T=I(!1);Fs((S,R,ae)=>(console.error("ErrorBoundary caught error:",S,ae),$.value=!0,H.value=y.value,ee.value=V(S),C.value=`${S.stack}

Component Info: ${ae}`,l.onError&&l.onError(S,R,ae),q("error",S,R,ae),ze.error("頁面出現錯誤","系統錯誤"),!1));const V=S=>S.message?S.message:S.name==="ChunkLoadError"?n("errors.resource_load_failed"):S.name==="NetworkError"?n("errors.network_error"):h.value,A=()=>{$.value=!1,H.value="",ee.value="",C.value="",T.value=!1,q("retry"),$s(()=>{})},D=()=>{E.push("/")},F=()=>{T.value=!T.value};return(S,R)=>(c(),P("div",Vs,[$.value?(c(),P("div",Bs,[e(s(Jt),{icon:"error",title:H.value,"sub-title":ee.value},{extra:t(()=>[a("div",Rs,[e(s(Ce),{type:"primary",onClick:A,"aria-label":s(n)("errors.retry")},{default:t(()=>[e(s(Fe),null,{default:t(()=>[e(s(kt))]),_:1}),R[0]||(R[0]=k(" 重試 ",-1))]),_:1},8,["aria-label"]),e(s(Ce),{onClick:D,"aria-label":s(n)("errors.back_home")},{default:t(()=>[e(s(Fe),null,{default:t(()=>[e(s(Kt))]),_:1}),R[1]||(R[1]=k(" 返回首頁 ",-1))]),_:1},8,["aria-label"]),b.value?(c(),U(s(Ce),{key:0,type:"info",onClick:F,"aria-expanded":T.value,"aria-controls":"error-details","aria-label":T.value?s(n)("errors.hide_details"):s(n)("errors.show_details")},{default:t(()=>[e(s(Fe),null,{default:t(()=>[e(s(Ct))]),_:1}),k(" "+g(T.value?s(n)("errors.hide_details"):s(n)("errors.show_details")),1)]),_:1},8,["aria-expanded","aria-label"])):N("",!0)]),T.value&&C.value?(c(),U(s(Qt),{key:0,class:"error-details",id:"error-details"},{default:t(()=>[e(s(es),{title:s(n)("errors.details_title"),name:"details"},{default:t(()=>[a("pre",Ls,g(C.value),1)]),_:1},8,["title"])]),_:1})):N("",!0)]),_:1},8,["title","sub-title"])])):xs(S.$slots,"default",{key:0},void 0,!0)]))}}),Is=Ee(As,[["__scopeId","data-v-db5a1b1a"]]),ce=u=>new Promise(p=>setTimeout(p,u));function js(u){const p=[],n=["image","document","video","audio","other"],l=["圖片","文件","影片","音訊","其他"],y={image:["jpg","png","gif","webp","svg"],document:["pdf","doc","docx","xls","xlsx","ppt","pptx"],video:["mp4","avi","mov","wmv","flv"],audio:["mp3","wav","flac","aac","ogg"],other:["zip","rar","7z","txt","json"]};for(let h=1;h<=u;h++){const b=n[Math.floor(Math.random()*n.length)],q=y[b],E=q[Math.floor(Math.random()*q.length)];p.push({id:`file-${h}`,name:`檔案${h}.${E}`,type:b,category:l[n.indexOf(b)],size:Math.floor(Math.random()*5e7)+1e3,url:`https://example.com/files/file-${h}.${E}`,thumbnail:b==="image"?`https://picsum.photos/200/200?random=${h}`:void 0,uploadDate:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),tags:[`標籤${Math.floor(Math.random()*10)+1}`,`標籤${Math.floor(Math.random()*10)+1}`].filter(($,H,ee)=>ee.indexOf($)===H),description:`這是檔案${h}的描述`,status:"completed"})}return p.sort((h,b)=>new Date(b.uploadDate).getTime()-new Date(h.uploadDate).getTime())}const Os=[{id:"1",name:"圖片",description:"圖片檔案",color:"#67C23A",icon:"Picture",count:0},{id:"2",name:"文件",description:"文檔檔案",color:"#409EFF",icon:"Document",count:0},{id:"3",name:"影片",description:"影片檔案",color:"#E6A23C",icon:"VideoPlay",count:0},{id:"4",name:"音訊",description:"音訊檔案",color:"#F56C6C",icon:"Headphone",count:0},{id:"5",name:"其他",description:"其他檔案",color:"#909399",icon:"Files",count:0}];let se=js(1e3),ye=[...Os];function he(){ye.forEach(u=>{u.count=se.filter(p=>p.category===u.name).length})}he();class pe{static async getFiles(p={}){await ce(300);try{let n=[...se];if(p.query){const C=p.query.toLowerCase();n=n.filter(T=>{var V,A,D;return T.name.toLowerCase().includes(C)||((V=T.category)==null?void 0:V.toLowerCase().includes(C))||((A=T.tags)==null?void 0:A.some(F=>F.toLowerCase().includes(C)))||((D=T.description)==null?void 0:D.toLowerCase().includes(C))})}if(p.category&&(n=n.filter(C=>C.category===p.category)),p.type&&(n=n.filter(C=>C.type===p.type)),p.tags&&p.tags.length>0&&(n=n.filter(C=>{var T;return(T=C.tags)==null?void 0:T.some(V=>p.tags.includes(V))})),p.dateRange){const C=new Date(p.dateRange.start),T=new Date(p.dateRange.end);n=n.filter(V=>{const A=new Date(V.uploadDate);return A>=C&&A<=T})}const l=p.sortBy||"date",y=p.sortOrder||"desc";n.sort((C,T)=>{let V,A;switch(l){case"name":V=C.name.toLowerCase(),A=T.name.toLowerCase();break;case"size":V=C.size,A=T.size;break;case"date":V=new Date(C.uploadDate).getTime(),A=new Date(T.uploadDate).getTime();break;case"type":V=C.type,A=T.type;break;default:return 0}return y==="asc"?V>A?1:-1:V<A?1:-1});const h=p.page||1,b=p.pageSize||50,q=n.length,E=Math.ceil(q/b),$=(h-1)*b,H=$+b;return{success:!0,data:{files:n.slice($,H),total:q,page:h,pageSize:b,totalPages:E}}}catch{return{success:!1,error:"獲取檔案列表失敗"}}}static async getFile(p){await ce(200);try{const n=se.find(l=>l.id===p);return n?{success:!0,data:n}:{success:!1,error:"檔案不存在"}}catch{return{success:!1,error:"獲取檔案失敗"}}}static async uploadFile(p,n={},l){try{for(let q=0;q<=100;q+=10)await ce(100),l==null||l(q);const h=(q=>{var $;const E=($=q.split(".").pop())==null?void 0:$.toLowerCase();return["jpg","jpeg","png","gif","webp","svg"].includes(E||"")?"image":["pdf","doc","docx","xls","xlsx","ppt","pptx"].includes(E||"")?"document":["mp4","avi","mov","wmv","flv"].includes(E||"")?"video":["mp3","wav","flac","aac","ogg"].includes(E||"")?"audio":"other"})(p.name),b={id:`file-${Date.now()}`,name:p.name,type:h,category:n.category,size:p.size,url:URL.createObjectURL(p),thumbnail:h==="image"?URL.createObjectURL(p):void 0,uploadDate:new Date().toISOString(),tags:n.tags||[],description:n.description||"",status:"completed"};return se.unshift(b),he(),{success:!0,data:b}}catch{return{success:!1,error:"檔案上傳失敗"}}}static async deleteFile(p){await ce(200);try{const n=se.findIndex(l=>l.id===p);return n===-1?{success:!1,error:"檔案不存在"}:(se.splice(n,1),he(),{success:!0})}catch{return{success:!1,error:"刪除檔案失敗"}}}static async deleteFiles(p){await ce(300);try{return se=se.filter(n=>!p.includes(n.id)),he(),{success:!0}}catch{return{success:!1,error:"批量刪除檔案失敗"}}}static async renameFile(p,n){await ce(200);try{const l=se.find(y=>y.id===p);return l?(l.name=n,{success:!0,data:l}):{success:!1,error:"檔案不存在"}}catch{return{success:!1,error:"重命名檔案失敗"}}}static async moveFile(p,n){await ce(200);try{const l=se.find(h=>h.id===p);if(!l)return{success:!1,error:"檔案不存在"};const y=ye.find(h=>h.id===n);return y?(l.category=y.name,he(),{success:!0,data:l}):{success:!1,error:"分類不存在"}}catch{return{success:!1,error:"移動檔案失敗"}}}static async copyFile(p){await ce(200);try{const n=se.find(q=>q.id===p);if(!n)return{success:!1,error:"檔案不存在"};const l=n.name.split("."),y=l.pop(),h=l.join("."),b={...n,id:`file-${Date.now()}`,name:`${h}_副本.${y}`,uploadDate:new Date().toISOString()};return se.unshift(b),he(),{success:!0,data:b}}catch{return{success:!1,error:"複製檔案失敗"}}}static async getCategories(){await ce(200);try{return he(),{success:!0,data:[...ye]}}catch{return{success:!1,error:"獲取分類列表失敗"}}}static async createCategory(p){await ce(200);try{const n={...p,id:`category-${Date.now()}`,count:0};return ye.push(n),{success:!0,data:n}}catch{return{success:!1,error:"創建分類失敗"}}}static async updateCategory(p,n){await ce(200);try{const l=ye.find(y=>y.id===p);return l?(Object.assign(l,n),{success:!0,data:l}):{success:!1,error:"分類不存在"}}catch{return{success:!1,error:"更新分類失敗"}}}static async deleteCategory(p){await ce(200);try{const n=ye.findIndex(y=>y.id===p);if(n===-1)return{success:!1,error:"分類不存在"};const l=ye[n];return se.forEach(y=>{y.category===(l==null?void 0:l.name)&&(y.category="其他")}),ye.splice(n,1),he(),{success:!0}}catch{return{success:!1,error:"刪除分類失敗"}}}static async getFileStats(){await ce(200);try{const p=se.length,n=se.reduce((h,b)=>h+b.size,0),l={},y={};return se.forEach(h=>{l[h.type]=(l[h.type]||0)+1,h.category&&(y[h.category]=(y[h.category]||0)+1)}),{success:!0,data:{totalFiles:p,totalSize:n,typeStats:l,categoryStats:y}}}catch{return{success:!1,error:"獲取統計信息失敗"}}}}function qe(){const u=Ut({files:[],categories:[],selectedFiles:[],loading:!1,uploading:!1,searchParams:{page:1,pageSize:50,sortBy:"date",sortOrder:"desc"},pagination:{page:1,pageSize:50,total:0,totalPages:0},stats:{totalFiles:0,totalSize:0,typeStats:{},categoryStats:{}}}),p=L(()=>u.selectedFiles.length>0),n=L(()=>u.selectedFiles.length),l=L(()=>u.files.length>0&&u.selectedFiles.length===u.files.length),y=L(()=>u.selectedFiles.length>0&&u.selectedFiles.length<u.files.length),h=o=>{if(o===0)return"0 B";const _=1024,z=["B","KB","MB","GB","TB"],Z=Math.floor(Math.log(o)/Math.log(_));return parseFloat((o/Math.pow(_,Z)).toFixed(2))+" "+z[Z]},b=o=>{const _=new Date(o),Z=Math.abs(new Date().getTime()-_.getTime()),te=Math.ceil(Z/(1e3*60*60*24));return te===1?"今天":te===2?"昨天":te<=7?`${te} 天前`:te<=30?`${Math.ceil(te/7)} 週前`:te<=365?`${Math.ceil(te/30)} 個月前`:`${Math.ceil(te/365)} 年前`},q=o=>{const _={image:"#67C23A",document:"#409EFF",video:"#E6A23C",audio:"#F56C6C",other:"#909399"};return _[o]||_.other},E=async o=>{u.loading=!0;try{const _={...u.searchParams,...o},z=await pe.getFiles(_);z.success&&z.data?(u.files=z.data.files,u.pagination={page:z.data.page,pageSize:z.data.pageSize,total:z.data.total,totalPages:z.data.totalPages},u.searchParams=_):w.error(z.error||"獲取檔案列表失敗")}catch{w.error("獲取檔案列表失敗")}finally{u.loading=!1}},$=async()=>{try{const o=await pe.getCategories();o.success&&o.data?u.categories=o.data:w.error(o.error||"獲取分類列表失敗")}catch{w.error("獲取分類列表失敗")}},H=async()=>{try{const o=await pe.getFileStats();o.success&&o.data?u.stats=o.data:w.error(o.error||"獲取統計信息失敗")}catch{w.error("獲取統計信息失敗")}},ee=async(o,_={},z)=>{u.uploading=!0;try{const Z=await pe.uploadFile(o,_,z);if(Z.success&&Z.data)return w.success("檔案上傳成功"),await E(),await H(),Z.data;throw w.error(Z.error||"檔案上傳失敗"),new Error(Z.error)}catch(Z){throw w.error("檔案上傳失敗"),Z}finally{u.uploading=!1}},C=async o=>{try{await Me.confirm("確定要刪除這個檔案嗎？","確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"});const _=await pe.deleteFile(o);if(_.success){w.success("檔案刪除成功"),await E(),await H();const z=u.selectedFiles.indexOf(o);z>-1&&u.selectedFiles.splice(z,1)}else w.error(_.error||"檔案刪除失敗")}catch(_){_!=="cancel"&&w.error("檔案刪除失敗")}},T=async()=>{if(u.selectedFiles.length===0){w.warning("請先選擇要刪除的檔案");return}try{await Me.confirm(`確定要刪除選中的 ${u.selectedFiles.length} 個檔案嗎？`,"確認批量刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"});const o=await pe.deleteFiles(u.selectedFiles);o.success?(w.success(`成功刪除 ${u.selectedFiles.length} 個檔案`),u.selectedFiles=[],await E(),await H()):w.error(o.error||"批量刪除失敗")}catch(o){o!=="cancel"&&w.error("批量刪除失敗")}},V=async(o,_)=>{try{const z=await pe.renameFile(o,_);z.success?(w.success("檔案重命名成功"),await E()):w.error(z.error||"檔案重命名失敗")}catch{w.error("檔案重命名失敗")}},A=async(o,_)=>{try{const z=await pe.moveFile(o,_);z.success?(w.success("檔案移動成功"),await E(),await H()):w.error(z.error||"檔案移動失敗")}catch{w.error("檔案移動失敗")}},D=async o=>{try{const _=await pe.copyFile(o);_.success?(w.success("檔案複製成功"),await E(),await H()):w.error(_.error||"檔案複製失敗")}catch{w.error("檔案複製失敗")}},F=async o=>{try{const _=await pe.createCategory(o);if(_.success)return w.success("分類創建成功"),await $(),_.data;throw w.error(_.error||"分類創建失敗"),new Error(_.error)}catch(_){throw w.error("分類創建失敗"),_}},S=async(o,_)=>{try{const z=await pe.updateCategory(o,_);if(z.success)return w.success("分類更新成功"),await $(),z.data;throw w.error(z.error||"分類更新失敗"),new Error(z.error)}catch(z){throw w.error("分類更新失敗"),z}},R=async o=>{try{await Me.confirm('確定要刪除這個分類嗎？該分類下的檔案將移動到"其他"分類。',"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"});const _=await pe.deleteCategory(o);_.success?(w.success("分類刪除成功"),await $(),await E(),await H()):w.error(_.error||"分類刪除失敗")}catch(_){_!=="cancel"&&w.error("分類刪除失敗")}},ae=o=>{const _=u.selectedFiles.indexOf(o);_>-1?u.selectedFiles.splice(_,1):u.selectedFiles.push(o)},me=()=>{l.value?u.selectedFiles=[]:u.selectedFiles=u.files.map(o=>o.id)},Q=()=>{u.selectedFiles=[]},oe=async o=>{await E({...u.searchParams,query:o,page:1})},ne=async o=>{await E({...u.searchParams,category:o,page:1})},W=async o=>{await E({...u.searchParams,type:o,page:1})},G=async(o,_="desc")=>{await E({...u.searchParams,sortBy:o,sortOrder:_,page:1})},re=async o=>{await E({...u.searchParams,page:o})},le=async o=>{await E({...u.searchParams,pageSize:o,page:1})},r=async()=>{await E({page:1,pageSize:50,sortBy:"date",sortOrder:"desc"})},v=async()=>{await Promise.all([E(),$(),H()])},B=async()=>{await v()};return Vt(()=>u.searchParams,()=>{},{deep:!0}),{state:u,hasSelectedFiles:p,selectedFilesCount:n,isAllSelected:l,isIndeterminate:y,formatFileSize:h,formatDate:b,getFileIconColor:q,fetchFiles:E,uploadFile:ee,deleteFile:C,deleteSelectedFiles:T,renameFile:V,moveFile:A,copyFile:D,fetchCategories:$,createCategory:F,updateCategory:S,deleteCategory:R,selectFile:ae,toggleSelectAll:me,clearSelection:Q,searchFiles:oe,filterByCategory:ne,filterByType:W,sortFiles:G,resetSearch:r,changePage:re,changePageSize:le,fetchStats:H,refresh:v,initialize:B}}const qs={class:"files-list-page"},Hs={class:"toolbar"},Ns={class:"toolbar-left"},Gs={class:"toolbar-right"},Ws={class:"stats-bar"},Zs={class:"stats-item"},Xs={class:"stats-label"},Ys={class:"stats-value"},Js={class:"stats-item"},Ks={class:"stats-label"},Qs={class:"stats-value"},ea={class:"stats-item"},ta={class:"stats-label"},sa={class:"stats-value"},aa={key:0,class:"batch-actions"},la={class:"files-container"},oa={key:0,class:"grid-view"},na=["onClick"],ra={class:"file-checkbox"},ia=["onClick"],ca={class:"image-error"},ua={key:1,class:"file-icon"},da={class:"file-overlay"},pa={class:"file-info"},fa=["title"],ma={class:"file-meta"},_a={class:"file-size"},ga={class:"file-date"},va={key:0,class:"file-tags"},ya={key:1,class:"list-view"},ha={class:"file-name-cell"},wa=["onClick"],ba={class:"pagination-container"},Le=200,Ke=6,bt=5,ka=Se({__name:"FilesListPage",setup(u){const p=Ss({loader:()=>Yt(()=>import("./FilePreview-B-spa4Bs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),loadingComponent:Us,errorComponent:Is,delay:200,timeout:1e4}),{canDelete:n}=ct(),{t:l}=Te(),y=qe(),{state:h,formatFileSize:b,formatDate:q,getFileIconColor:E,deleteFile:$,deleteSelectedFiles:H,copyFile:ee,selectFile:C,toggleSelectAll:T,clearSelection:V,searchFiles:A,filterByCategory:D,changePage:F,changePageSize:S,resetSearch:R,initialize:ae}=y,me=it(),Q=I(""),oe=I(""),ne=I("grid"),W=I(!1),G=I(null),re=I(!1),le=I(1),r=I(20),v=I(!1),B=I(),o=I(0),_=I(600),z=L(()=>h.categories.find(M=>M.id===oe.value)),Z=L(()=>h.files),te=L(()=>h.stats.totalFiles),j=L(()=>h.stats.totalSize),m=L(()=>h.selectedFiles),i=L(()=>h.categories),O=L(()=>Math.ceil(Z.value.length/Ke)),J=L(()=>O.value*Le),fe=L(()=>Math.max(0,Math.floor(o.value/Le)-bt)),ve=L(()=>{const M=Math.ceil(_.value/Le);return Math.min(O.value,fe.value+M+bt*2)}),Pe=L(()=>fe.value*Le),Ue=L(()=>{const M=fe.value*Ke,d=ve.value*Ke;return Z.value.slice(M,d)}),He=L(()=>{const M=(h.pagination.page-1)*h.pagination.pageSize,d=M+h.pagination.pageSize;return Z.value.slice(M,d)}),Ne=M=>{const d=M.target;o.value=d.scrollTop};let Ve;const xe=async()=>{clearTimeout(Ve),Ve=setTimeout(async()=>{Q.value.trim()?await A(Q.value):await R(),o.value=0},300)},$e=async()=>{var M;if(oe.value){const d=(M=h.categories.find(Be=>Be.id===oe.value))==null?void 0:M.name;d&&await D(d)}else await R();o.value=0},we=M=>{T()},Ge=M=>{C(M.id)},We=M=>{C(M)},x=M=>{h.selectedFiles=M.map(d=>d.id)},be=M=>{G.value=M,W.value=!0},K=M=>{const d=document.createElement("a");d.href=M.url,d.download=M.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),w.success(l("files.messages.download_started",{name:M.name}))},ue=async(M,d)=>{switch(M){case"preview":be(d);break;case"download":K(d);break;case"share":w.success(l("files.messages.feature_wip"));break;case"copy":await ee(d.id);break;case"rename":w.success(l("files.messages.feature_wip"));break;case"move":w.success(l("files.messages.feature_wip"));break;case"favorite":w.success(l("files.messages.feature_wip"));break;case"delete":await $(d.id);break}},Bt=()=>{w.success(l("files.messages.batch_download_started",{count:m.value.length}))},Rt=()=>{w.success(l("files.messages.feature_wip"))},Lt=async()=>{await H()},At=async M=>{await S(M)},It=async M=>{await F(M)},jt=()=>{me.push("/files/upload")},ut=M=>{switch(M){case"image":return et;case"document":return ot;case"video":return lt;case"audio":return at;default:return Ae}},Ot=M=>({image:"圖片",video:"影片",audio:"音訊",document:"文件",other:"其他"})[M]||l("common.unknown");return rt(async()=>{await ae(),B.value&&(_.value=B.value.clientHeight);const M=()=>{B.value&&(_.value=B.value.clientHeight)};window.addEventListener("resize",M),zs(()=>{window.removeEventListener("resize",M)})}),Vt(Q,M=>{M.trim()||R()}),(M,d)=>{const Be=ts,qt=ss,Ht=st,Nt=Ft,Gt=xt,ie=Ce,Ze=ns,X=Fe,dt=is,Wt=nt,de=ds,pt=us,ft=cs,Xe=je,ke=St,Zt=Et,Xt=ps,mt=zt;return c(),P("div",qs,[a("div",Hs,[a("div",Ns,[e(qt,{separator:"/"},{default:t(()=>[e(Be,null,{default:t(()=>[k(g(s(l)("files.title")),1)]),_:1}),z.value?(c(),U(Be,{key:0},{default:t(()=>[k(g(z.value.name),1)]),_:1})):N("",!0)]),_:1})]),a("div",Gs,[e(Ht,{modelValue:Q.value,"onUpdate:modelValue":d[0]||(d[0]=f=>Q.value=f),placeholder:s(l)("files.search_placeholder"),"prefix-icon":s(as),clearable:"",style:{width:"300px","margin-right":"16px"},onInput:xe},null,8,["modelValue","placeholder","prefix-icon"]),e(Gt,{modelValue:oe.value,"onUpdate:modelValue":d[1]||(d[1]=f=>oe.value=f),placeholder:s(l)("files.select_category"),clearable:"",style:{width:"150px","margin-right":"16px"},onChange:$e},{default:t(()=>[(c(!0),P(_e,null,ge(i.value,f=>(c(),U(Nt,{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(Ze,null,{default:t(()=>[e(ie,{type:ne.value==="grid"?"primary":"default",onClick:d[2]||(d[2]=f=>ne.value="grid"),icon:s(ls)},null,8,["type","icon"]),e(ie,{type:ne.value==="list"?"primary":"default",onClick:d[3]||(d[3]=f=>ne.value="list"),icon:s(os)},null,8,["type","icon"])]),_:1}),e(ie,{type:"primary",onClick:jt,style:{"margin-left":"16px"}},{default:t(()=>[e(X,null,{default:t(()=>[e(s($t))]),_:1}),k(" "+g(s(l)("files.upload")),1)]),_:1})])]),a("div",Ws,[a("div",Zs,[a("span",Xs,g(s(l)("files.stats.total_files"))+"：",1),a("span",Ys,g(te.value),1)]),a("div",Js,[a("span",Ks,g(s(l)("files.stats.selected"))+"：",1),a("span",Qs,g(m.value.length),1)]),a("div",ea,[a("span",ta,g(s(l)("files.stats.total_size"))+"：",1),a("span",sa,g(s(b)(j.value)),1)])]),m.value.length>0?(c(),P("div",aa,[e(ie,{onClick:Bt,icon:s(Ye)},{default:t(()=>[...d[10]||(d[10]=[k("批量下載",-1)])]),_:1},8,["icon"]),e(ie,{onClick:Rt,icon:s(Je)},{default:t(()=>[...d[11]||(d[11]=[k("批量移動",-1)])]),_:1},8,["icon"]),s(n)("files")?(c(),U(ie,{key:0,onClick:Lt,type:"danger",icon:s(De)},{default:t(()=>[k(g(s(l)("files.actions.batch_delete")),1)]),_:1},8,["icon"])):N("",!0),e(ie,{onClick:s(V),icon:s(rs)},{default:t(()=>[k(g(s(l)("files.actions.clear_selection")),1)]),_:1},8,["onClick","icon"])])):N("",!0),tt((c(),P("div",la,[ne.value==="grid"?(c(),P("div",oa,[e(dt,{modelValue:re.value,"onUpdate:modelValue":d[4]||(d[4]=f=>re.value=f),onChange:we,class:"select-all-checkbox"},{default:t(()=>[k(g(s(l)("common.select_all")),1)]),_:1},8,["modelValue"]),a("div",{ref_key:"gridContainer",ref:B,class:"virtual-grid-container",onScroll:Ne},[a("div",{class:"virtual-grid-content",style:Ie({height:`${J.value}px`})},[a("div",{class:"virtual-grid-viewport",style:Ie({transform:`translateY(${Pe.value}px)`})},[(c(!0),P(_e,null,ge(Ue.value,f=>(c(),P("div",{key:f.id,class:Oe(["file-card",{selected:m.value.includes(f.id)}]),onClick:Y=>Ge(f)},[a("div",ra,[e(dt,{"model-value":m.value.includes(f.id),onChange:Y=>We(f.id),onClick:d[5]||(d[5]=Re(()=>{},["stop"]))},null,8,["model-value","onChange"])]),a("div",{class:"file-preview",onClick:Y=>be(f)},[f.type==="image"?(c(),U(Wt,{key:0,src:f.thumbnail||f.url,fit:"cover",class:"preview-image",lazy:""},{error:t(()=>[a("div",ca,[e(X,null,{default:t(()=>[e(s(et))]),_:1})])]),_:1},8,["src"])):(c(),P("div",ua,[e(X,{size:48,color:s(E)(f.type)},{default:t(()=>[(c(),U(wt(ut(f.type))))]),_:2},1032,["color"])])),a("div",da,[e(Ze,null,{default:t(()=>[e(ie,{size:"small",onClick:Re(Y=>be(f),["stop"])},{default:t(()=>[e(X,null,{default:t(()=>[e(s(_t))]),_:1})]),_:1},8,["onClick"]),e(ie,{size:"small",onClick:Re(Y=>K(f),["stop"])},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Ye))]),_:1})]),_:1},8,["onClick"]),e(ft,{onClick:d[6]||(d[6]=Re(()=>{},["stop"])),trigger:"click"},{dropdown:t(()=>[e(pt,null,{default:t(()=>[e(de,{onClick:Y=>ue("share",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(vt))]),_:1}),d[12]||(d[12]=k("分享 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("copy",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(yt))]),_:1}),d[13]||(d[13]=k("複製 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("rename",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Qe))]),_:1}),d[14]||(d[14]=k("重命名 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("move",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Je))]),_:1}),d[15]||(d[15]=k("移動 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("favorite",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(ht))]),_:1}),d[16]||(d[16]=k("收藏 ",-1))]),_:1},8,["onClick"]),s(n)("files")?(c(),U(de,{key:0,divided:"",onClick:Y=>ue("delete",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(De))]),_:1}),d[17]||(d[17]=k("刪除 ",-1))]),_:1},8,["onClick"])):N("",!0)]),_:2},1024)]),default:t(()=>[e(ie,{size:"small"},{default:t(()=>[e(X,null,{default:t(()=>[e(s(gt))]),_:1})]),_:1})]),_:2},1024)]),_:2},1024)])],8,ia),a("div",pa,[a("div",{class:"file-name",title:f.name},g(f.name),9,fa),a("div",ma,[a("span",_a,g(s(b)(f.size)),1),a("span",ga,g(s(q)(f.uploadDate)),1)]),f.tags&&f.tags.length>0?(c(),P("div",va,[(c(!0),P(_e,null,ge(f.tags.slice(0,2),Y=>(c(),U(Xe,{key:Y,size:"small",type:"info"},{default:t(()=>[k(g(Y),1)]),_:2},1024))),128)),f.tags.length>2?(c(),U(Xe,{key:0,size:"small",type:"info"},{default:t(()=>[k(" +"+g(f.tags.length-2),1)]),_:2},1024)):N("",!0)])):N("",!0)])],10,na))),128))],4)],4)],544)])):(c(),P("div",ya,[tt((c(),U(Zt,{ref:"tableRef",data:He.value,onSelectionChange:x,height:"600"},{default:t(()=>[e(ke,{type:"selection",width:"55"}),e(ke,{label:s(l)("files.table.name"),"min-width":"200"},{default:t(({row:f})=>[a("div",ha,[e(X,{color:s(E)(f.type)},{default:t(()=>[(c(),U(wt(ut(f.type))))]),_:2},1032,["color"]),a("span",{class:"file-name",onClick:Y=>be(f)},g(f.name),9,wa)])]),_:1},8,["label"]),e(ke,{label:s(l)("files.table.size"),width:"100"},{default:t(({row:f})=>[k(g(s(b)(f.size)),1)]),_:1},8,["label"]),e(ke,{label:s(l)("files.table.type"),width:"80"},{default:t(({row:f})=>[k(g(Ot(f.type)),1)]),_:1},8,["label"]),e(ke,{label:s(l)("files.table.category"),width:"100"},{default:t(({row:f})=>[f.category?(c(),U(Xe,{key:0,size:"small"},{default:t(()=>[k(g(f.category),1)]),_:2},1024)):N("",!0)]),_:1},8,["label"]),e(ke,{label:s(l)("files.table.upload_time"),width:"150"},{default:t(({row:f})=>[k(g(s(q)(f.uploadDate)),1)]),_:1},8,["label"]),e(ke,{label:s(l)("files.table.operations"),width:"200",fixed:"right"},{default:t(({row:f})=>[e(Ze,null,{default:t(()=>[e(ie,{size:"small",onClick:Y=>be(f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(_t))]),_:1})]),_:1},8,["onClick"]),e(ie,{size:"small",onClick:Y=>K(f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Ye))]),_:1})]),_:1},8,["onClick"]),e(ft,{trigger:"click"},{dropdown:t(()=>[e(pt,null,{default:t(()=>[e(de,{onClick:Y=>ue("share",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(vt))]),_:1}),d[18]||(d[18]=k("分享 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("copy",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(yt))]),_:1}),d[19]||(d[19]=k("複製 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("rename",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Qe))]),_:1}),d[20]||(d[20]=k("重命名 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("move",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(Je))]),_:1}),d[21]||(d[21]=k("移動 ",-1))]),_:1},8,["onClick"]),e(de,{onClick:Y=>ue("favorite",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(ht))]),_:1}),d[22]||(d[22]=k("收藏 ",-1))]),_:1},8,["onClick"]),s(n)("files")?(c(),U(de,{key:0,divided:"",onClick:Y=>ue("delete",f)},{default:t(()=>[e(X,null,{default:t(()=>[e(s(De))]),_:1}),d[23]||(d[23]=k("刪除 ",-1))]),_:1},8,["onClick"])):N("",!0)]),_:2},1024)]),default:t(()=>[e(ie,{size:"small"},{default:t(()=>[e(X,null,{default:t(()=>[e(s(gt))]),_:1})]),_:1})]),_:2},1024)]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[mt,v.value]]),a("div",ba,[e(Xt,{"current-page":le.value,"onUpdate:currentPage":d[7]||(d[7]=f=>le.value=f),"page-size":r.value,"onUpdate:pageSize":d[8]||(d[8]=f=>r.value=f),"page-sizes":[20,50,100,200],total:Z.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:At,onCurrentChange:It},null,8,["current-page","page-size","total"])])]))])),[[mt,v.value]]),e(s(p),{modelValue:W.value,"onUpdate:modelValue":d[9]||(d[9]=f=>W.value=f),file:G.value,onDownload:K},null,8,["modelValue","file"])])}}}),Ca=Ee(ka,[["__scopeId","data-v-30610ada"]]),Wl=Object.freeze(Object.defineProperty({__proto__:null,default:Ca},Symbol.toStringTag,{value:"Module"})),Fa={class:"file-upload-container"},xa={class:"upload-content"},$a={class:"upload-icon"},za={class:"upload-text"},Sa={class:"upload-hint"},Ea={class:"upload-limit"},Ma={key:0,class:"file-list"},Da={class:"file-list-header"},Ta={class:"list-actions"},Pa={class:"file-items"},Ua={class:"file-preview"},Va={key:1,class:"file-icon"},Ba={class:"file-info"},Ra=["title"],La={class:"file-meta"},Aa={class:"file-size"},Ia={class:"file-type"},ja={key:0,class:"upload-progress"},Oa={key:1,class:"upload-status"},qa={class:"file-actions"},Ha=Se({__name:"FileUpload",props:{multiple:{type:Boolean,default:!0},accept:{default:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.mp4,.mp3,.zip,.rar"},maxSize:{default:100*1024*1024},maxCount:{default:10},autoUpload:{type:Boolean,default:!1},uploadUrl:{default:"/api/files/upload"}},emits:["before-upload","upload-success","upload-error","upload-progress","file-remove","exceed"],setup(u,{expose:p,emit:n}){const l=u,y=n,h=I(),b=I([]),q=qe(),{formatFileSize:E,getFileIconColor:$}=q,H=L(()=>l.accept.split(",").map(v=>v.replace(".","").toUpperCase()).join(", ")),ee=L(()=>b.value.some(r=>r.status==="ready"||r.status==="fail")),C=r=>{var o;if(r.size>l.maxSize)return w.error(`檔案 ${r.name} 大小超過限制 ${E(l.maxSize)}`),!1;const v="."+((o=r.name.split(".").pop())==null?void 0:o.toLowerCase());if(!l.accept.split(",").includes(v))return w.error(`不支援的檔案格式：${v}`),!1;if(y("before-upload",r),!l.autoUpload){const _=Date.now()+Math.random();r.uid=_;const z={name:r.name,size:r.size,type:ne(r),status:"ready",percentage:0,uid:_,raw:r};return z.type==="image"&&(z.url=URL.createObjectURL(r)),b.value.push(z),!1}return!0},T=(r,v)=>{const B=b.value.find(o=>o.uid===v.uid);B&&(B.status="success",B.percentage=100),y("upload-success",r,v)},V=(r,v)=>{const B=b.value.find(o=>o.uid===v.uid);B&&(B.status="fail"),y("upload-error",r,v)},A=(r,v)=>{const B=b.value.find(o=>o.uid===v.uid);B&&(B.status="uploading",B.percentage=Math.round(r.loaded/r.total*100)),y("upload-progress",r,v)},D=(r,v)=>{r.url&&r.url.startsWith("blob:")&&URL.revokeObjectURL(r.url),y("file-remove",r,v)},F=(r,v)=>{w.warning(`最多只能上傳 ${l.maxCount} 個檔案`),y("exceed",r,v)},S=async r=>{if(r.raw){r.status="uploading",r.percentage=0;try{await oe(r),r.status="success",r.percentage=100,w.success(`檔案 ${r.name} 上傳成功`)}catch{r.status="fail",w.error(`檔案 ${r.name} 上傳失敗`)}}},R=r=>{r.status="ready",r.percentage=0,S(r)},ae=async()=>{const r=b.value.filter(v=>v.status==="ready"||v.status==="fail");for(const v of r)await S(v)},me=r=>{const v=b.value[r],B=v==null?void 0:v.url;B&&B.startsWith("blob:")&&URL.revokeObjectURL(B),b.value.splice(r,1)},Q=()=>{var r;b.value.forEach(v=>{v.url&&v.url.startsWith("blob:")&&URL.revokeObjectURL(v.url)}),b.value=[],(r=h.value)==null||r.clearFiles()},oe=r=>new Promise((v,B)=>{const o=r,_=setInterval(()=>{(o.percentage??0)<90?o.percentage=(o.percentage??0)+Math.random()*20:(o.percentage??0)<100&&(o.percentage=100,clearInterval(_),Math.random()>.1?v(r):B(new Error("模擬上傳失敗")))},200)}),ne=r=>{var B;const v=(B=r.name.split(".").pop())==null?void 0:B.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(v||"")?"image":["mp4","avi","mov","wmv","flv"].includes(v||"")?"video":["mp3","wav","flac","aac"].includes(v||"")?"audio":["pdf","doc","docx","xls","xlsx","ppt","pptx","txt"].includes(v||"")?"document":"other"},W=r=>({image:"圖片",video:"影片",audio:"音訊",document:"文件",other:"其他"})[r]||"未知",G=r=>({uploading:r.status==="uploading",success:r.status==="success",error:r.status==="fail"}),re=r=>{switch(r){case"success":return"success";case"fail":return"danger";case"uploading":return"warning";default:return"info"}},le=r=>({ready:"準備中",uploading:"上傳中",success:"成功",fail:"失敗"})[r]||r;return p({uploadAll:ae,clearAll:Q,getFileList:()=>b.value}),(r,v)=>{const B=Fe,o=fs,_=Ce,z=nt,Z=Mt,te=je;return c(),P("div",Fa,[e(o,{ref_key:"uploadRef",ref:h,class:"upload-dragger",drag:"",multiple:u.multiple,accept:u.accept,"before-upload":C,"on-success":T,"on-error":V,"on-progress":A,"on-remove":D,"on-exceed":F,limit:u.maxCount,"file-list":b.value,"auto-upload":!1,"show-file-list":!1},{default:t(()=>[a("div",xa,[a("div",$a,[e(B,{size:"48",color:"#c0c4cc"},{default:t(()=>[e(s(ms))]),_:1})]),a("div",za,[v[0]||(v[0]=a("div",{class:"upload-title"},[k("拖拽檔案到此處，或"),a("em",null,"點擊上傳")],-1)),a("div",Sa," 支援格式："+g(H.value),1),a("div",Ea," 單檔大小限制："+g(s(E)(u.maxSize))+"，最多 "+g(u.maxCount)+" 個檔案 ",1)])])]),_:1},8,["multiple","accept","limit","file-list"]),b.value.length>0?(c(),P("div",Ma,[a("div",Da,[a("h4",null,"檔案列表 ("+g(b.value.length)+")",1),a("div",Ta,[e(_,{size:"small",onClick:Q},{default:t(()=>[...v[1]||(v[1]=[k("清空",-1)])]),_:1}),e(_,{size:"small",type:"primary",onClick:ae,disabled:!ee.value},{default:t(()=>[...v[2]||(v[2]=[k(" 上傳全部 ",-1)])]),_:1},8,["disabled"])])]),a("div",Pa,[(c(!0),P(_e,null,ge(b.value,(j,m)=>(c(),P("div",{key:j.uid,class:Oe(["file-item",G(j)])},[a("div",Ua,[j.type==="image"&&j.url?(c(),U(z,{key:0,src:j.url,fit:"cover",class:"preview-image"},null,8,["src"])):(c(),P("div",Va,[e(B,{size:"24",color:s($)(j.type)},{default:t(()=>[j.type==="image"?(c(),U(s(et),{key:0})):j.type==="document"?(c(),U(s(ot),{key:1})):j.type==="video"?(c(),U(s(lt),{key:2})):j.type==="audio"?(c(),U(s(at),{key:3})):(c(),U(s(Ae),{key:4}))]),_:2},1032,["color"])]))]),a("div",Ba,[a("div",{class:"file-name",title:j.name},g(j.name),9,Ra),a("div",La,[a("span",Aa,g(s(E)(j.size??0)),1),a("span",Ia,g(W(j.type)),1)]),j.status==="uploading"?(c(),P("div",ja,[e(Z,{percentage:j.percentage,status:j.percentage===100?"success":"","stroke-width":4},null,8,["percentage","status"])])):(c(),P("div",Oa,[e(te,{type:re(j.status),size:"small"},{default:t(()=>[k(g(le(j.status)),1)]),_:2},1032,["type"])]))]),a("div",qa,[j.status==="ready"?(c(),U(_,{key:0,size:"small",type:"primary",onClick:i=>S(j)},{default:t(()=>[...v[3]||(v[3]=[k(" 上傳 ",-1)])]),_:1},8,["onClick"])):N("",!0),j.status==="fail"?(c(),U(_,{key:1,size:"small",type:"warning",onClick:i=>R(j)},{default:t(()=>[...v[4]||(v[4]=[k(" 重試 ",-1)])]),_:1},8,["onClick"])):N("",!0),e(_,{size:"small",type:"danger",onClick:i=>me(m),disabled:j.status==="uploading"},{default:t(()=>[...v[5]||(v[5]=[k(" 移除 ",-1)])]),_:1},8,["onClick","disabled"])])],2))),128))])])):N("",!0)])}}}),Na=Ee(Ha,[["__scopeId","data-v-4105d540"]]),Ga={class:"files-upload-page"},Wa={class:"card-header"},Za={class:"header-actions"},Xa={class:"upload-section"},Ya={class:"upload-area"},Ja={class:"upload-info"},Ka={class:"info-content"},Qa={class:"info-item"},el={class:"info-item"},tl={class:"info-item"},sl={class:"stats-content"},al={class:"stat-item"},ll={class:"stat-label"},ol={class:"stat-value"},nl={class:"stat-item"},rl={class:"stat-label"},il={class:"stat-value success"},cl={class:"stat-item"},ul={class:"stat-label"},dl={class:"stat-value error"},pl={class:"stat-item"},fl={class:"stat-label"},ml={class:"stat-value uploading"},_l={key:0,class:"file-details-section"},gl={class:"file-list"},vl={class:"file-preview"},yl={key:1,class:"file-icon"},hl={class:"file-info"},wl={class:"file-basic-info"},bl={class:"file-name"},kl={class:"file-meta"},Cl={class:"file-size"},Fl={class:"file-type"},xl={key:0,class:"upload-progress"},$l={class:"progress-text"},zl={key:1,class:"upload-status"},Sl={key:0,class:"error-message"},El={key:0,class:"file-settings"},Ml={class:"file-actions"},Dl={key:0,class:"batch-actions"},Tl={class:"batch-buttons"},Pl={key:1,class:"action-buttons"},Ul=Se({__name:"FilesUploadPage",setup(u){const p=it(),n=qe(),{state:l,uploadFile:y,formatFileSize:h,getFileIconColor:b,fetchCategories:q}=n,E=L(()=>l.categories),{t:$}=Te(),H=I(!1),ee=I(),C=I([]),T=I(""),V=I([]),A=I(100*1024*1024),D=I(10),F=I(".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.mp4,.mp3,.zip,.rar"),{canCreate:S}=ct(),R=I(["重要","工作","個人","專案","會議","報告","設計","開發","測試","文檔"]),ae=L(()=>"JPG, PNG, GIF, PDF, DOC, XLS, PPT, TXT, MP4, MP3, ZIP, RAR"),me=L(()=>C.value.some(m=>m.status==="ready"||m.status==="error")),Q=L(()=>{const m={total:C.value.length,success:0,failed:0,uploading:0};return C.value.forEach(i=>{switch(i.status){case"success":m.success++;break;case"error":m.failed++;break;case"uploading":m.uploading++;break}}),m}),oe=m=>{const i=_(m),O={uid:Date.now()+Math.random(),name:m.name,size:m.size,type:i,file:m,status:"ready",progress:0,category:z(i),tags:[],description:"",preview:null,error:null};if(i==="image"){const J=new FileReader;J.onload=fe=>{var ve;O.preview=(ve=fe.target)==null?void 0:ve.result},J.readAsDataURL(m)}return C.value.push(O),!1},ne=(m,i)=>{const O=C.value.find(J=>J.uid===i.uid);O&&(O.status="success",O.progress=100,O.response=m),w.success(`檔案 ${i.name} 上傳成功`)},W=(m,i)=>{const O=C.value.find(J=>J.uid===i.uid);O&&(O.status="error",O.error=m.message||"上傳失敗"),w.error(`檔案 ${i.name} 上傳失敗`)},G=(m,i)=>{const O=C.value.find(J=>J.uid===i.uid);O&&(O.progress=Math.round(m.loaded/m.total*100))},re=async()=>{const m=C.value.filter(i=>i.status==="ready"||i.status==="error");if(m.length===0){w.warning("沒有需要上傳的檔案");return}H.value=!0;try{for(const i of m)await le(i);w.success($("files.messages.all_uploaded"))}catch{w.error($("files.messages.partial_failed"))}finally{H.value=!1}},le=async m=>{m.status="uploading",m.progress=0;try{const i={category:m.category,tags:m.tags,description:m.description},O=await y(m.file,i,J=>{m.progress=J});m.status="success",m.progress=100,m.response=O}catch(i){throw m.status="error",m.error=(i==null?void 0:i.message)||"上傳失敗",i}},r=async m=>{try{await le(m),w.success($("files.messages.retry_success",{name:m.name}))}catch{w.error($("files.messages.retry_failed",{name:m.name}))}},v=m=>{C.value.splice(m,1)},B=async()=>{if(C.value.length!==0)try{await Me.confirm($("files.messages.clear_all_confirm"),$("files.messages.clear_all_title"),{confirmButtonText:$("common.confirm"),cancelButtonText:$("common.cancel"),type:"warning"}),C.value=[]}catch{}},o=()=>{C.value.forEach(m=>{T.value&&(m.category=T.value),V.value.length>0&&(m.tags=[...new Set([...m.tags,...V.value])])}),w.success("批量設定已應用"),T.value="",V.value=[]},_=m=>{const i=(m.name.split(".").pop()||"").toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(i)?"image":["mp4","avi","mov","wmv","flv"].includes(i)?"video":["mp3","wav","flac","aac"].includes(i)?"audio":["pdf","doc","docx","xls","xlsx","ppt","pptx","txt"].includes(i)?"document":"other"},z=m=>({image:"images",video:"videos",audio:"audio",document:"documents",other:"others"})[m]||"others",Z=m=>({image:"圖片",video:"影片",audio:"音訊",document:"文件",other:"其他"})[m]||"未知",te=m=>({ready:"準備中",uploading:"上傳中",success:"成功",error:"失敗"})[m]||m,j=()=>{p.push("/files")};return rt(async()=>{await q()}),(m,i)=>{const O=Fe,J=Ce,fe=gs,ve=Dt,Pe=_s,Ue=ys,He=nt,Ne=Mt,Ve=je,xe=Ft,$e=xt,we=Pt,Ge=st,We=Tt;return c(),P("div",Ga,[e(ve,null,{header:t(()=>[a("div",Wa,[a("h2",null,g(s($)("files.upload")),1),a("div",Za,[e(J,{onClick:j},{default:t(()=>[e(O,null,{default:t(()=>[e(s(hs))]),_:1}),k(" "+g(s($)("common.back")),1)]),_:1})])])]),default:t(()=>[a("div",Xa,[e(Pe,{gutter:20},{default:t(()=>[e(fe,{span:16},{default:t(()=>[a("div",Ya,[e(Na,{ref_key:"fileUploadRef",ref:ee,multiple:!0,accept:F.value,"max-size":A.value,"max-count":D.value,onUploadSuccess:ne,onUploadError:W,onUploadProgress:G,onBeforeUpload:oe},null,8,["accept","max-size","max-count"])])]),_:1}),e(fe,{span:8},{default:t(()=>[a("div",Ja,[e(ve,{shadow:"never",class:"info-card"},{header:t(()=>[a("h3",null,g(s($)("files.upload_guide")),1)]),default:t(()=>[a("div",Ka,[a("div",Qa,[e(O,null,{default:t(()=>[e(s(Ct))]),_:1}),a("span",null,g(s($)("files.supported_formats"))+"："+g(ae.value),1)]),a("div",el,[e(O,null,{default:t(()=>[e(s(vs))]),_:1}),a("span",null,g(s($)("files.max_file_size"))+"："+g(s(h)(A.value)),1)]),a("div",tl,[e(O,null,{default:t(()=>[e(s(Ae))]),_:1}),a("span",null,g(s($)("files.max_file_count"))+"："+g(D.value)+" "+g(s($)("files.items")),1)])])]),_:1}),Q.value.total>0?(c(),U(ve,{key:0,shadow:"never",class:"stats-card"},{header:t(()=>[a("h3",null,g(s($)("files.upload_stats")),1)]),default:t(()=>[a("div",sl,[a("div",al,[a("span",ll,g(s($)("files.stats.total"))+"：",1),a("span",ol,g(Q.value.total),1)]),a("div",nl,[a("span",rl,g(s($)("files.stats.success"))+"：",1),a("span",il,g(Q.value.success),1)]),a("div",cl,[a("span",ul,g(s($)("files.stats.failed"))+"：",1),a("span",dl,g(Q.value.failed),1)]),a("div",pl,[a("span",fl,g(s($)("files.stats.uploading"))+"：",1),a("span",ml,g(Q.value.uploading),1)])])]),_:1})):N("",!0)])]),_:1})]),_:1})]),C.value.length>0?(c(),P("div",_l,[e(Ue,null,{default:t(()=>[k(g(s($)("files.detail_settings")),1)]),_:1}),a("div",gl,[(c(!0),P(_e,null,ge(C.value,(x,be)=>(c(),P("div",{key:x.uid,class:Oe(["file-item",{uploading:x.status==="uploading",success:x.status==="success",error:x.status==="error"}])},[a("div",vl,[x.type==="image"&&x.preview?(c(),U(He,{key:0,src:x.preview,fit:"cover",class:"preview-image"},null,8,["src"])):(c(),P("div",yl,[e(O,{size:"32",color:s(b)(x.type)},{default:t(()=>[x.type==="document"?(c(),U(s(ot),{key:0})):x.type==="video"?(c(),U(s(lt),{key:1})):x.type==="audio"?(c(),U(s(at),{key:2})):(c(),U(s(Ae),{key:3}))]),_:2},1032,["color"])]))]),a("div",hl,[a("div",wl,[a("h4",bl,g(x.name),1),a("div",kl,[a("span",Cl,g(s(h)(x.size)),1),a("span",Fl,g(Z(x.type)),1)])]),x.status==="uploading"?(c(),P("div",xl,[e(Ne,{percentage:x.progress,status:x.progress===100?"success":"","stroke-width":6},null,8,["percentage","status"]),a("span",$l,g(x.progress)+"%",1)])):(c(),P("div",zl,[e(Ve,{type:x.status==="success"?"success":x.status==="error"?"danger":"info",size:"small"},{default:t(()=>[k(g(te(x.status)),1)]),_:2},1032,["type"]),x.error?(c(),P("span",Sl,g(x.error),1)):N("",!0)]))]),x.status!=="uploading"?(c(),P("div",El,[e(We,{model:x,"label-width":"80px",size:"small"},{default:t(()=>[e(we,{label:"分類"},{default:t(()=>[e($e,{modelValue:x.category,"onUpdate:modelValue":K=>x.category=K,placeholder:"選擇分類",style:{width:"100%"}},{default:t(()=>[(c(!0),P(_e,null,ge(E.value,K=>(c(),U(xe,{key:K.id,label:K.name,value:K.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(we,{label:"標籤"},{default:t(()=>[e($e,{modelValue:x.tags,"onUpdate:modelValue":K=>x.tags=K,multiple:"",filterable:"","allow-create":"",placeholder:"添加標籤",style:{width:"100%"}},{default:t(()=>[(c(!0),P(_e,null,ge(R.value,K=>(c(),U(xe,{key:K,label:K,value:K},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(we,{label:"描述"},{default:t(()=>[e(Ge,{modelValue:x.description,"onUpdate:modelValue":K=>x.description=K,type:"textarea",rows:2,placeholder:"檔案描述（可選）",maxlength:"200","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"])])):N("",!0),a("div",Ml,[x.status==="error"?(c(),U(J,{key:0,size:"small",type:"primary",onClick:K=>r(x)},{default:t(()=>[e(O,null,{default:t(()=>[e(s(kt))]),_:1}),i[2]||(i[2]=k(" 重試 ",-1))]),_:1},8,["onClick"])):N("",!0),e(J,{size:"small",type:"danger",onClick:K=>v(be),disabled:x.status==="uploading"},{default:t(()=>[e(O,null,{default:t(()=>[e(s(De))]),_:1}),i[3]||(i[3]=k(" 移除 ",-1))]),_:1},8,["onClick","disabled"])])],2))),128))]),C.value.length>1?(c(),P("div",Dl,[e(Ue,null,{default:t(()=>[...i[4]||(i[4]=[k("批量操作",-1)])]),_:1}),e(Pe,{gutter:20},{default:t(()=>[e(fe,{span:12},{default:t(()=>[e(we,{label:"批量分類"},{default:t(()=>[e($e,{modelValue:T.value,"onUpdate:modelValue":i[0]||(i[0]=x=>T.value=x),placeholder:"選擇分類",style:{width:"100%"}},{default:t(()=>[(c(!0),P(_e,null,ge(E.value,x=>(c(),U(xe,{key:x.id,label:x.name,value:x.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(fe,{span:12},{default:t(()=>[e(we,{label:"批量標籤"},{default:t(()=>[e($e,{modelValue:V.value,"onUpdate:modelValue":i[1]||(i[1]=x=>V.value=x),multiple:"",filterable:"","allow-create":"",placeholder:"添加標籤",style:{width:"100%"}},{default:t(()=>[(c(!0),P(_e,null,ge(R.value,x=>(c(),U(xe,{key:x,label:x,value:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a("div",Tl,[e(J,{onClick:o},{default:t(()=>[...i[5]||(i[5]=[k("應用到所有檔案",-1)])]),_:1}),e(J,{onClick:B,type:"danger"},{default:t(()=>[...i[6]||(i[6]=[k("清空列表",-1)])]),_:1})])])):N("",!0)])):N("",!0),C.value.length>0?(c(),P("div",Pl,[e(J,{size:"large",onClick:B},{default:t(()=>[...i[7]||(i[7]=[k("清空列表",-1)])]),_:1}),s(S)("files")?(c(),U(J,{key:0,type:"primary",size:"large",onClick:re,loading:H.value,disabled:!me.value},{default:t(()=>[e(O,null,{default:t(()=>[e(s($t))]),_:1}),k(" "+g(H.value?"上傳中...":"開始上傳"),1)]),_:1},8,["loading","disabled"])):N("",!0)])):N("",!0)]),_:1})])}}}),Vl=Ee(Ul,[["__scopeId","data-v-8f4c5f3e"]]),Zl=Object.freeze(Object.defineProperty({__proto__:null,default:Vl},Symbol.toStringTag,{value:"Module"})),Bl={class:"file-categories-page"},Rl={class:"card-header"},Ll={class:"category-name"},Al=Se({__name:"FileCategoriesPage",setup(u){const{canCreate:p,canEdit:n,canDelete:l}=ct(),{t:y}=Te(),h=qe(),{state:b,fetchCategories:q,createCategory:E,updateCategory:$,deleteCategory:H,formatDate:ee}=h,C=L(()=>b.categories),T=L(()=>b.loading),V=I(!1),A=I(!1),D=I(),F=Ut({id:"",name:"",description:"",color:"#409EFF"}),S=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#9C27B0","#FF5722","#795548","#607D8B","#4CAF50"],R={name:[{required:!0,message:y("files.categories.rules.name_required"),trigger:"blur"},{min:1,max:50,message:y("files.categories.rules.name_length"),trigger:"blur"}],description:[{max:200,message:y("files.categories.rules.description_max"),trigger:"blur"}],color:[{required:!0,message:y("files.categories.rules.color_required"),trigger:"change"}]},ae=()=>{A.value=!1,Q(),V.value=!0},me=W=>{A.value=!0,F.id=W.id,F.name=W.name,F.description=W.description,F.color=W.color,V.value=!0},Q=()=>{F.id="",F.name="",F.description="",F.color="#409EFF",D.value&&D.value.resetFields()},oe=async()=>{if(D.value)try{await D.value.validate();const W={name:F.name,description:F.description,color:F.color};A.value?await $(F.id,W):await E(W),V.value=!1,Q()}catch{}},ne=async W=>{if(W.fileCount>0){w.warning(y("files.messages.category_has_files"));return}try{await Me.confirm(y("files.messages.confirm_delete_category",{name:W.name}),y("files.messages.confirm_delete_title"),{confirmButtonText:y("common.confirm"),cancelButtonText:y("common.cancel"),type:"warning"}),await H(W.id)}catch{}};return rt(async()=>{await q()}),(W,G)=>{const re=Fe,le=Ce,r=St,v=je,B=Et,o=Dt,_=st,z=Pt,Z=ks,te=Tt,j=Cs,m=zt;return c(),P("div",Bl,[e(o,null,{header:t(()=>[a("div",Rl,[a("h2",null,g(s(y)("files.categories.title")),1),s(p)("files")?(c(),U(le,{key:0,type:"primary",onClick:ae},{default:t(()=>[e(re,null,{default:t(()=>[e(s(bs))]),_:1}),G[5]||(G[5]=k(" 新增分類 ",-1))]),_:1})):N("",!0)])]),default:t(()=>[tt((c(),U(B,{data:C.value},{default:t(()=>[e(r,{label:"分類名稱",prop:"name","min-width":"200"},{default:t(({row:i})=>[a("div",Ll,[e(re,{color:i.color,size:"16"},{default:t(()=>[e(s(ws))]),_:1},8,["color"]),a("span",null,g(i.name),1)])]),_:1}),e(r,{label:"描述",prop:"description","min-width":"300"}),e(r,{label:s(y)("files.categories.table.count"),prop:"fileCount",width:"120",align:"center"},{default:t(({row:i})=>[e(v,{size:"small"},{default:t(()=>[k(g(i.fileCount),1)]),_:2},1024)]),_:1},8,["label"]),e(r,{label:"顏色",prop:"color",width:"100",align:"center"},{default:t(({row:i})=>[a("div",{class:"color-preview",style:Ie({backgroundColor:i.color})},null,4)]),_:1}),e(r,{label:s(y)("common.created_at"),prop:"createdAt",width:"180"},{default:t(({row:i})=>[k(g(s(ee)(i.createdAt)),1)]),_:1},8,["label"]),e(r,{label:s(y)("files.table.operations"),width:"150",align:"center"},{default:t(({row:i})=>[s(n)("files")?(c(),U(le,{key:0,size:"small",onClick:O=>me(i)},{default:t(()=>[e(re,null,{default:t(()=>[e(s(Qe))]),_:1})]),_:1},8,["onClick"])):N("",!0),s(l)("files")?(c(),U(le,{key:1,size:"small",type:"danger",onClick:O=>ne(i)},{default:t(()=>[e(re,null,{default:t(()=>[e(s(De))]),_:1})]),_:1},8,["onClick"])):N("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[m,T.value]])]),_:1}),e(j,{modelValue:V.value,"onUpdate:modelValue":G[4]||(G[4]=i=>V.value=i),title:A.value?s(y)("files.categories.dialog.edit_title"):s(y)("files.categories.dialog.create_title"),width:"500px"},{footer:t(()=>[e(le,{onClick:G[3]||(G[3]=i=>V.value=!1)},{default:t(()=>[...G[6]||(G[6]=[k("取消",-1)])]),_:1}),e(le,{type:"primary",onClick:oe},{default:t(()=>[k(g(A.value?"更新":"新增"),1)]),_:1})]),default:t(()=>[e(te,{model:F,rules:R,ref_key:"categoryFormRef",ref:D,"label-width":"80px"},{default:t(()=>[e(z,{label:s(y)("files.categories.form.name"),prop:"name"},{default:t(()=>[e(_,{modelValue:F.name,"onUpdate:modelValue":G[0]||(G[0]=i=>F.name=i),placeholder:s(y)("files.categories.form.name_placeholder"),maxlength:"50","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(z,{label:s(y)("files.categories.form.description"),prop:"description"},{default:t(()=>[e(_,{modelValue:F.description,"onUpdate:modelValue":G[1]||(G[1]=i=>F.description=i),type:"textarea",rows:3,placeholder:s(y)("files.categories.form.description_placeholder"),maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(z,{label:s(y)("files.categories.form.color"),prop:"color"},{default:t(()=>[e(Z,{modelValue:F.color,"onUpdate:modelValue":G[2]||(G[2]=i=>F.color=i),predefine:S},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Il=Ee(Al,[["__scopeId","data-v-27131659"]]),Xl=Object.freeze(Object.defineProperty({__proto__:null,default:Il},Symbol.toStringTag,{value:"Module"}));export{Is as E,Wl as F,Us as L,qe as a,Zl as b,Xl as c,ct as u};
