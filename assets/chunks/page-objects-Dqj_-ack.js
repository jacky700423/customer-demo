const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/ObjectFormDialog-C8je3PdU.js","assets/chunks/ui-B8MTJjzS.js","assets/chunks/vendor-other-DMrNeO-R.js","assets/chunks/utils-nO-s2RVl.js","assets/chunks/vendor-C-KThoNQ.js","assets/ui-hG_bPTIg.css","assets/chunks/page-admin-Txqa2T3a.js","assets/page-admin-xTGGVsnG.css","assets/ObjectFormDialog-kZJhWEbe.css","assets/chunks/ObjectDetailDialog-DrS1HCGz.js","assets/chunks/page-files-Cwuz-WAk.js","assets/chunks/page-dashboard-DWJ9bqym.js","assets/chunks/page-auth-B067K4bE.js","assets/page-auth-CNFP2bWF.css","assets/page-dashboard-DwmsIj7C.css","assets/page-files-Dh3oni4u.css","assets/ObjectDetailDialog-BZVLNd7Z.css","assets/chunks/ImagePreviewDialog-DpDVHOoq.js","assets/ImagePreviewDialog-D6LKrsaq.css","assets/chunks/ImageUploadDialog-Duq3Gg7a.js","assets/ImageUploadDialog-xNVet0yE.css"])))=>i.map(i=>d[i]);
import{f as Je,_ as Te}from"./page-dashboard-DWJ9bqym.js";import{aC as mt,e as _t,f as ft,i as bt,w as vt,c as we,m as Ve,v as He,g as gt,S as Fe,aa as We,a9 as ht,j as Qe,a5 as Ze,F as Ke,G as Xe,aD as et,b as De,r as Ae,aE as jt,N as yt,J as wt,ao as Vt,ad as kt,au as Ot,ae as tt,ac as at,k as lt,aF as xt,ap as Ct,a8 as $t,a7 as Et,a6 as Tt,az as ot,A as St,C as st,D as nt,h as Ut,V as Pt,H as Dt,aG as It,aH as Mt,M as Ft,av as Lt,aI as Nt,at as zt,u as Rt,aJ as Bt,aK as qt,n as At,am as Gt,aL as Yt,ai as Jt,aj as Ht,al as Wt,ak as Qt,W as Zt,ag as Kt,aM as Xt,aN as ea,aO as ta,aP as aa,aQ as la,aR as oa,Z as sa,E as na,aS as ra}from"./ui-B8MTJjzS.js";import{b2 as w,bg as X,aY as ke,b5 as U,a_ as h,b0 as t,b1 as l,a$ as e,ba as ia,aZ as T,b9 as ae,bb as u,bk as j,bf as ca,bh as da,br as rt,b3 as Se,bi as ua,bc as a,b6 as de,b7 as ue,bs as it,bl as Me,bt as Ue,bu as Pe,bn as pa,bo as ma}from"./vendor-other-DMrNeO-R.js";import{d as _a,u as Ie,b as Le,a as ct,o as fa}from"./vendor-C-KThoNQ.js";import{d as ba}from"./utils-nO-s2RVl.js";import{h as K,a as Ne,c as _e,v as va,b as ga,d as ha}from"./page-auth-B067K4bE.js";import{u as ze,L as Ge,E as Ye}from"./page-files-Cwuz-WAk.js";import{_ as Oe}from"./page-admin-Txqa2T3a.js";const ie={getObjects(c){return K.get("/objects",c)},getObject(c){return K.get(`/objects/${c}`)},createObject(c){return K.post("/objects",c)},updateObject(c,n){return K.put(`/objects/${c}`,n)},deleteObject(c){return K.delete(`/objects/${c}`)},batchDeleteObjects(c){return K.post("/objects/batch-delete",{ids:c})},uploadImages(c,n){const $=new FormData;return n.forEach(k=>{$.append("images[]",k)}),K.upload(`/objects/${c}/images`,$)},deleteImage(c,n){return K.delete(`/objects/${c}/images`,{data:{image:n}})},getObjectTypes(){return K.get("/objects/types")},getObjectStatuses(){return K.get("/objects/statuses")},getObjectStats(){return K.get("/objects/stats")},exportObjects(c){return K.get("/objects/export",c).then(n=>new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))},importObjects(c){const n=new FormData;return n.append("file",c),K.upload("/objects/import",n)}},Re=_a("objects",()=>{const c=w([]),n=w(null),$=w({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),k=w(!1),p=w({}),_=w([]),I=w([]),r=X(()=>c.value.filter(f=>f.status==="available")),A=X(()=>c.value.filter(f=>f.status==="sold")),L=X(()=>c.value.reduce((f,m)=>f+m.price,0)),N=X(()=>c.value.length>0?L.value/c.value.length:0);return{objects:c,currentObject:n,pagination:$,loading:k,filters:p,objectTypes:_,objectStatuses:I,availableObjects:r,soldObjects:A,totalValue:L,averagePrice:N,fetchObjects:async f=>{try{k.value=!0;const m=await ie.getObjects(f);return m.success&&m.data&&(c.value=m.data.data,$.value={current_page:m.data.current_page,last_page:m.data.last_page,per_page:m.data.per_page,total:m.data.total,from:m.data.from,to:m.data.to}),m}catch(m){throw console.error("Fetch objects error:",m),m}finally{k.value=!1}},fetchObject:async f=>{try{k.value=!0;const m=await ie.getObject(f);if(m.success&&m.data){n.value=m.data;const P=c.value.findIndex(x=>x.id===f);P!==-1&&(c.value[P]=m.data)}return m}catch(m){throw console.error("Fetch object error:",m),m}finally{k.value=!1}},createObject:async f=>{try{k.value=!0;const m=await ie.createObject(f);return m.success&&m.data&&(c.value.unshift(m.data),$.value.total+=1),m}catch(m){throw console.error("Create object error:",m),m}finally{k.value=!1}},updateObject:async(f,m)=>{var P;try{k.value=!0;const x=await ie.updateObject(f,m);if(x.success&&x.data){const Q=c.value.findIndex(le=>le.id===f);Q!==-1&&(c.value[Q]=x.data),((P=n.value)==null?void 0:P.id)===f&&(n.value=x.data)}return x}catch(x){throw console.error("Update object error:",x),x}finally{k.value=!1}},deleteObject:async f=>{var m;try{k.value=!0;const P=await ie.deleteObject(f);return P.success&&(c.value=c.value.filter(x=>x.id!==f),$.value.total-=1,((m=n.value)==null?void 0:m.id)===f&&(n.value=null)),P}catch(P){throw console.error("Delete object error:",P),P}finally{k.value=!1}},batchDeleteObjects:async f=>{try{k.value=!0;const m=await ie.batchDeleteObjects(f);return m.success&&(c.value=c.value.filter(P=>!f.includes(P.id)),$.value.total-=f.length),m}catch(m){throw console.error("Batch delete objects error:",m),m}finally{k.value=!1}},uploadObjectImages:async(f,m)=>{var P;try{const x=await ie.uploadImages(f,m);if(x.success&&x.data){const Q=c.value.findIndex(le=>le.id===f);Q!==-1&&c.value[Q]&&(c.value[Q].images=[...c.value[Q].images,...x.data.images]),((P=n.value)==null?void 0:P.id)===f&&(n.value.images=[...n.value.images,...x.data.images])}return x}catch(x){throw console.error("Upload object images error:",x),x}},fetchObjectTypes:async()=>{try{const f=await ie.getObjectTypes();return f.success&&f.data&&(_.value=f.data),f}catch(f){throw console.error("Fetch object types error:",f),f}},fetchObjectStatuses:async()=>{try{const f=await ie.getObjectStatuses();return f.success&&f.data&&(I.value=f.data),f}catch(f){throw console.error("Fetch object statuses error:",f),f}},setFilters:f=>{p.value={...f}},clearFilters:()=>{p.value={}},resetState:()=>{c.value=[],n.value=null,$.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0},p.value={}}}}),ja={class:"confirm-content"},ya={class:"confirm-icon"},wa={class:"confirm-message"},Va={class:"message-text"},ka={key:0,class:"sub-message"},Oa={class:"dialog-footer"},xa=ke({__name:"ConfirmDialog",props:{modelValue:{type:Boolean},title:{default:"確認操作"},message:{},subMessage:{},type:{default:"warning"},confirmText:{default:"確認"},cancelText:{default:"取消"},confirmType:{default:"primary"},width:{default:"420px"},loading:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","cancel"],setup(c,{emit:n}){const $=c,k=n,p=X({get:()=>$.modelValue,set:N=>k("update:modelValue",N)}),_=X(()=>({warning:vt,info:bt,success:ft,error:_t,question:mt})[$.type]),I=X(()=>({warning:"#E6A23C",info:"#409EFF",success:"#67C23A",error:"#F56C6C",question:"#909399"})[$.type]),r=()=>{k("confirm")},A=()=>{k("cancel"),p.value=!1},L=N=>{$.loading||(A(),N())};return(N,G)=>{const Y=we,q=Ve,M=He;return h(),U(M,{modelValue:p.value,"onUpdate:modelValue":G[0]||(G[0]=B=>p.value=B),title:c.title,width:c.width,"before-close":L,"align-center":""},{footer:t(()=>[l("div",Oa,[e(q,{onClick:A,disabled:c.loading},{default:t(()=>[j(u(c.cancelText),1)]),_:1},8,["disabled"]),e(q,{type:c.confirmType,onClick:r,loading:c.loading},{default:t(()=>[j(u(c.confirmText),1)]),_:1},8,["type","loading"])])]),default:t(()=>[l("div",ja,[l("div",ya,[e(Y,{size:48,color:I.value},{default:t(()=>[(h(),U(ia(_.value)))]),_:1},8,["color"])]),l("div",wa,[l("p",Va,u(c.message),1),c.subMessage?(h(),T("p",ka,u(c.subMessage),1)):ae("",!0)])])]),_:1},8,["modelValue","title","width"])}}}),Ca=Oe(xa,[["__scopeId","data-v-6e4722e2"]]);let ce=null;const Be=()=>{const c=_=>new Promise(I=>{ce||(ce=document.createElement("div"),document.body.appendChild(ce));const r=w(!0),A=w(!1),L=ca(Ca,{modelValue:r.value,loading:A.value,..._,"onUpdate:modelValue":G=>{r.value=G,G||(N(),I(!1))},onConfirm:()=>{N(),I(!0)},onCancel:()=>{N(),I(!1)}});L.use(gt),L.mount(ce);const N=()=>{setTimeout(()=>{L.unmount(),ce&&ce.parentNode&&(ce.parentNode.removeChild(ce),ce=null)},300)}});return{confirm:c,confirmDelete:_=>c({title:"確認刪除",message:_?`確定要刪除「${_}」嗎？`:"確定要刪除選中的項目嗎？",subMessage:"此操作無法撤銷，請謹慎操作。",type:"warning",confirmText:"刪除",confirmType:"danger"}),confirmSave:(_=!0)=>_?c({title:"儲存變更",message:"檢測到未保存的更改，是否要保存？",type:"question",confirmText:"保存",cancelText:"不儲存",confirmType:"primary"}):Promise.resolve(!0),confirmLeave:()=>c({title:"離開頁面",message:"您有未保存的更改，確定要離開此頁面嗎？",subMessage:"離開後所有未保存的更改將會丟失。",type:"warning",confirmText:"離開",cancelText:"留在此頁",confirmType:"warning"}),confirmAction:(_,I)=>c({title:`確認${_}`,message:`確定要${_}嗎？`,subMessage:I,type:"question",confirmText:_,confirmType:"primary"})}},$a={class:"object-list-page"},Ea={class:"page-header"},Ta={class:"header-left"},Sa={class:"page-title"},Ua={class:"page-description"},Pa={key:0,class:"header-actions"},Da={class:"filter-section"},Ia={class:"filter-row"},Ma={class:"filter-item"},Fa={class:"filter-item"},La={class:"filter-item"},Na={class:"filter-item"},za={class:"filter-item"},Ra={class:"filter-actions"},Ba={class:"stats-section"},qa={class:"stat-card"},Aa={class:"stat-icon available"},Ga={class:"stat-content"},Ya={class:"stat-value"},Ja={class:"stat-label"},Ha={class:"stat-card"},Wa={class:"stat-icon sold"},Qa={class:"stat-content"},Za={class:"stat-value"},Ka={class:"stat-label"},Xa={class:"stat-card"},el={class:"stat-icon value"},tl={class:"stat-content"},al={class:"stat-value"},ll={class:"stat-label"},ol={class:"stat-card"},sl={class:"stat-icon average"},nl={class:"stat-content"},rl={class:"stat-value"},il={class:"stat-label"},cl={class:"table-section"},dl={class:"table-header"},ul={class:"table-actions"},pl={class:"object-name"},ml={class:"name"},_l={class:"address"},fl={class:"price"},bl={key:1,class:"grid-view"},vl=["onClick"],gl={class:"card-image"},hl={class:"card-overlay"},jl={class:"status-badge"},yl={class:"card-content"},wl={class:"card-title"},Vl={class:"card-address"},kl={class:"card-details"},Ol={class:"detail-item"},xl={class:"detail-item"},Cl={class:"card-price"},$l={class:"card-actions"},El={class:"pagination-wrapper"},Tl={style:{padding:"16px","text-align":"center"}},Sl={style:{padding:"16px","text-align":"center"}},Ul=ke({__name:"ObjectsListPage",setup(c){const n=Ue(()=>Te(()=>import("./ObjectFormDialog-C8je3PdU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),$=Ue(()=>Te(()=>import("./ObjectDetailDialog-DrS1HCGz.js"),__vite__mapDeps([9,1,2,3,4,5,10,11,6,7,12,13,14,15,16]))),k=Ie(),p=Re(),_=Ne(),{confirmDelete:I}=Be(),{t:r}=Le(),{canCreate:A,canEdit:L,canDelete:N}=ze(),G=w(!1),Y=w(""),q=w("table"),M=w([]),B=w(1),s=w(20),ne=w(!1),H=w(!1),pe=w(null),fe=w(null),z=da({type:"",status:"",min_price:null,max_price:null}),be=X(()=>p.objectTypes),f=X(()=>p.objectStatuses),m=b=>Je(b),P=b=>ba(b).format("YYYY-MM-DD"),x=b=>be.value.find(v=>v===b)||b||"未知",Q=b=>f.value.find(v=>v===b)||b||"未知",le=b=>({sold:"info",reserved:"warning",inactive:"danger"})[b]||"info",he=()=>{clearTimeout(S),S=setTimeout(()=>{E()},500)};let S;const V=()=>{B.value=1,E()},J=()=>{Object.assign(z,{type:"",status:"",min_price:null,max_price:null}),Y.value="",E()},oe=()=>{B.value=1,E()},je=b=>{M.value=b.map(v=>Number(v.id))},re=b=>{s.value=b,B.value=1,E()},ve=b=>{B.value=b,E()},g=()=>{pe.value=null,ne.value=!0},o=b=>{fe.value=b,H.value=!0},y=b=>{pe.value=b,ne.value=!0},W=async(b,v)=>{try{if(!await I(v||r("objects.detail.title_fallback")))return;await p.deleteObject(b),_.success(r("objects.messages.delete_success")),E()}catch(D){console.error("刪除物件失敗:",D),_.error((D==null?void 0:D.message)||r("objects.messages.delete_failed"),r("errors.toast_title"))}},Z=async()=>{if(M.value.length===0){_.warning(r("objects.messages.batch_select_first"));return}try{if(!await I(`${M.value.length} 個物件`))return;await Promise.all(M.value.map(v=>p.deleteObject(Number(v)))),_.success(`成功刪除 ${M.value.length} 個物件`),M.value=[],E()}catch(b){console.error("批量刪除失敗:",b),_.error((b==null?void 0:b.message)||r("objects.messages.delete_failed"),r("errors.toast_title"))}},O=()=>{if(M.value.length===0){_.warning(r("objects.messages.batch_select_first"));return}try{_.info(r("objects.messages.export_tips"))}catch{_.error(r("objects.messages.export_failed"),r("errors.toast_title"))}},C=()=>{try{_.info(r("objects.messages.import_tips"))}catch{_.error(r("objects.messages.import_failed"),r("errors.toast_title"))}},E=async()=>{G.value=!0;try{const b={page:B.value,per_page:s.value,search:Y.value||void 0,type:z.type||void 0,status:z.status||void 0,min_price:z.min_price??void 0,max_price:z.max_price??void 0};await p.fetchObjects(b)}catch(b){console.error("獲取物業列表失敗:",b),_.error(r("objects.messages.load_failed"),r("errors.toast_title"))}finally{G.value=!1}};return rt(()=>k.currentRoute.value.query,()=>{const b=k.currentRoute.value.query;b.type&&(z.type=b.type),b.status&&(z.status=b.status),b.search&&(Y.value=b.search),E()},{immediate:!0}),Se(async()=>{G.value=!0;try{await Promise.all([p.fetchObjectTypes(),p.fetchObjectStatuses(),E()])}catch(b){console.error("初始化失敗:",b),_.error(r("objects.messages.init_failed"),r("errors.toast_title"))}finally{G.value=!1}}),(b,v)=>{const D=we,R=Ve,ee=Qe,F=Xe,se=Ke,ge=et,xe=De,Ce=$t,te=kt,$e=Ot,ye=tt,i=Vt,dt=lt,ut=Ct,qe=ua("Loading"),pt=at;return h(),T("div",$a,[l("div",Ea,[l("div",Ta,[l("h1",Sa,u(a(r)("objects.title")),1),l("p",Ua,u(a(r)("objects.desc")),1)]),a(A)("objects")?(h(),T("div",Pa,[e(R,{type:"primary",onClick:g},{default:t(()=>[e(D,null,{default:t(()=>[e(a(Fe))]),_:1}),j(" "+u(a(r)("objects.create")),1)]),_:1}),e(R,{onClick:O},{default:t(()=>[e(D,null,{default:t(()=>[e(a(We))]),_:1}),j(" "+u(a(r)("objects.export")),1)]),_:1}),e(R,{onClick:C},{default:t(()=>[e(D,null,{default:t(()=>[e(a(ht))]),_:1}),j(" "+u(a(r)("objects.import")),1)]),_:1})])):ae("",!0)]),l("div",Da,[e(xe,null,{default:t(()=>[l("div",Ia,[l("div",Ma,[e(ee,{modelValue:Y.value,"onUpdate:modelValue":v[0]||(v[0]=d=>Y.value=d),placeholder:a(r)("objects.search_placeholder"),"prefix-icon":a(Ze),clearable:"",onInput:he},null,8,["modelValue","placeholder","prefix-icon"])]),l("div",Fa,[e(se,{modelValue:z.type,"onUpdate:modelValue":v[1]||(v[1]=d=>z.type=d),placeholder:a(r)("objects.type_placeholder"),clearable:"",onChange:V},{default:t(()=>[(h(!0),T(de,null,ue(be.value,d=>(h(),U(F,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),l("div",La,[e(se,{modelValue:z.status,"onUpdate:modelValue":v[2]||(v[2]=d=>z.status=d),placeholder:a(r)("objects.status_placeholder"),clearable:"",onChange:V},{default:t(()=>[(h(!0),T(de,null,ue(f.value,d=>(h(),U(F,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),l("div",Na,[e(ge,{modelValue:z.min_price,"onUpdate:modelValue":v[3]||(v[3]=d=>z.min_price=d),placeholder:a(r)("objects.min_price_placeholder"),min:0,step:1e4,"controls-position":"right",onChange:V},null,8,["modelValue","placeholder"])]),l("div",za,[e(ge,{modelValue:z.max_price,"onUpdate:modelValue":v[4]||(v[4]=d=>z.max_price=d),placeholder:a(r)("objects.max_price_placeholder"),min:0,step:1e4,"controls-position":"right",onChange:V},null,8,["modelValue","placeholder"])]),l("div",Ra,[e(R,{onClick:J},{default:t(()=>[j(u(a(r)("objects.reset")),1)]),_:1}),e(R,{type:"primary",onClick:oe},{default:t(()=>[j(u(a(r)("objects.apply_filters")),1)]),_:1})])])]),_:1})]),l("div",Ba,[l("div",qa,[l("div",Aa,[e(D,null,{default:t(()=>[e(a(Ae))]),_:1})]),l("div",Ga,[l("div",Ya,u(a(p).availableObjects.length),1),l("div",Ja,u(a(r)("objects.stats.available")),1)])]),l("div",Ha,[l("div",Wa,[e(D,null,{default:t(()=>[e(a(jt))]),_:1})]),l("div",Qa,[l("div",Za,u(a(p).soldObjects.length),1),l("div",Ka,u(a(r)("objects.stats.sold")),1)])]),l("div",Xa,[l("div",el,[e(D,null,{default:t(()=>[e(a(yt))]),_:1})]),l("div",tl,[l("div",al,u(m(a(p).totalValue)),1),l("div",ll,u(a(r)("objects.stats.total_value")),1)])]),l("div",ol,[l("div",sl,[e(D,null,{default:t(()=>[e(a(wt))]),_:1})]),l("div",nl,[l("div",rl,u(m(a(p).averagePrice)),1),l("div",il,u(a(r)("objects.stats.avg_price")),1)])])]),l("div",cl,[e(xe,null,{header:t(()=>[l("div",dl,[l("span",null,u(a(r)("objects.list_title"))+" ("+u(a(p).pagination.total)+")",1),l("div",ul,[e(Ce,null,{default:t(()=>[e(R,{type:q.value==="table"?"primary":"default",onClick:v[5]||(v[5]=d=>q.value="table")},{default:t(()=>[e(D,null,{default:t(()=>[e(a(Et))]),_:1})]),_:1},8,["type"]),e(R,{type:q.value==="grid"?"primary":"default",onClick:v[6]||(v[6]=d=>q.value="grid")},{default:t(()=>[e(D,null,{default:t(()=>[e(a(Tt))]),_:1})]),_:1},8,["type"])]),_:1}),M.value.length>0&&a(N)("objects")?(h(),U(R,{key:0,type:"danger",onClick:Z},{default:t(()=>[j(u(a(r)("objects.actions.batch_delete"))+" ("+u(M.value.length)+") ",1)]),_:1})):ae("",!0)])])]),default:t(()=>[q.value==="table"?it((h(),U(i,{key:0,data:a(p).objects,onSelectionChange:je},{default:t(()=>[e(te,{type:"selection",width:"55"}),e(te,{label:a(r)("objects.table.image"),width:"100"},{default:t(({row:d})=>{var me;return[e($e,{src:((me=d.images)==null?void 0:me[0])||"/placeholder-property.jpg","preview-src-list":d.images||[],class:"object-image",fit:"cover"},null,8,["src","preview-src-list"])]}),_:1},8,["label"]),e(te,{prop:"name",label:a(r)("objects.table.name"),"min-width":"150"},{default:t(({row:d})=>[l("div",pl,[l("span",ml,u(d.name),1),l("span",_l,u(d.address),1)])]),_:1},8,["label"]),e(te,{prop:"type",label:a(r)("objects.table.type"),width:"100"},{default:t(({row:d})=>[e(ye,null,{default:t(()=>[j(u(x(d.type)),1)]),_:2},1024)]),_:1},8,["label"]),e(te,{prop:"status",label:a(r)("objects.table.status"),width:"100"},{default:t(({row:d})=>[e(ye,{type:le(d.status)},{default:t(()=>[j(u(Q(d.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(te,{prop:"price",label:a(r)("objects.table.price"),width:"120"},{default:t(({row:d})=>[l("span",fl,u(m(d.price)),1)]),_:1},8,["label"]),e(te,{prop:"area",label:a(r)("objects.table.area"),width:"100"},{default:t(({row:d})=>[j(u(d.area)+"m² ",1)]),_:1},8,["label"]),e(te,{prop:"created_at",label:a(r)("objects.table.created_at"),width:"120"},{default:t(({row:d})=>[j(u(P(d.created_at)),1)]),_:1},8,["label"]),e(te,{label:a(r)("objects.table.operations"),width:"200",fixed:"right"},{default:t(({row:d})=>[e(R,{text:"",type:"primary",onClick:me=>o(d.id)},{default:t(()=>[j(u(a(r)("objects.actions.view")),1)]),_:1},8,["onClick"]),a(L)("objects")?(h(),U(R,{key:0,text:"",type:"primary",onClick:me=>y(d.id)},{default:t(()=>[...v[13]||(v[13]=[j(" 編輯 ",-1)])]),_:1},8,["onClick"])):ae("",!0),a(N)("objects")?(h(),U(R,{key:1,text:"",type:"danger",onClick:me=>W(d.id)},{default:t(()=>[...v[14]||(v[14]=[j(" 刪除 ",-1)])]),_:1},8,["onClick"])):ae("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[pt,a(p).loading]]):(h(),T("div",bl,[(h(!0),T(de,null,ue(a(p).objects,d=>{var me;return h(),T("div",{key:d.id,class:"object-card",onClick:Ee=>o(d.id)},[l("div",gl,[e($e,{src:((me=d.images)==null?void 0:me[0])||"/placeholder-property.jpg",fit:"cover",class:"image"},null,8,["src"]),l("div",hl,[e(dt,{modelValue:M.value,"onUpdate:modelValue":v[7]||(v[7]=Ee=>M.value=Ee),label:d.id,onClick:v[8]||(v[8]=Me(()=>{},["stop"]))},null,8,["modelValue","label"])]),l("div",jl,[e(ye,{type:le(d.status),size:"small"},{default:t(()=>[j(u(Q(d.status)),1)]),_:2},1032,["type"])])]),l("div",yl,[l("h3",wl,u(d.name),1),l("p",Vl,u(d.address),1),l("div",kl,[l("span",Ol,[e(D,null,{default:t(()=>[e(a(Ae))]),_:1}),j(" "+u(x(d.type)),1)]),l("span",xl,[e(D,null,{default:t(()=>[e(a(xt))]),_:1}),j(" "+u(d.area)+"m² ",1)])]),l("div",Cl,u(m(d.price)),1),l("div",$l,[a(L)("objects")?(h(),U(R,{key:0,text:"",type:"primary",onClick:Me(Ee=>y(d.id),["stop"])},{default:t(()=>[j(u(a(r)("objects.actions.edit")),1)]),_:1},8,["onClick"])):ae("",!0),a(N)("objects")?(h(),U(R,{key:1,text:"",type:"danger",onClick:Me(Ee=>W(d.id),["stop"])},{default:t(()=>[j(u(a(r)("objects.actions.delete")),1)]),_:1},8,["onClick"])):ae("",!0)])])],8,vl)}),128))])),l("div",El,[e(ut,{"current-page":B.value,"onUpdate:currentPage":v[9]||(v[9]=d=>B.value=d),"page-size":s.value,"onUpdate:pageSize":v[10]||(v[10]=d=>s.value=d),total:a(p).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),_:1})]),(h(),U(Pe,null,{default:t(()=>[e(a(n),{modelValue:ne.value,"onUpdate:modelValue":v[11]||(v[11]=d=>ne.value=d),"object-id":pe.value},null,8,["modelValue","object-id"])]),fallback:t(()=>[l("div",Tl,[e(D,null,{default:t(()=>[e(qe)]),_:1})])]),_:1})),(h(),U(Pe,null,{default:t(()=>[e(a($),{modelValue:H.value,"onUpdate:modelValue":v[12]||(v[12]=d=>H.value=d),"object-id":fe.value},null,8,["modelValue","object-id"])]),fallback:t(()=>[l("div",Sl,[e(D,null,{default:t(()=>[e(qe)]),_:1})])]),_:1}))])}}}),Pl=Oe(Ul,[["__scopeId","data-v-96f589f4"]]),No=Object.freeze(Object.defineProperty({__proto__:null,default:Pl},Symbol.toStringTag,{value:"Module"})),Dl={class:"object-edit-page"},Il={class:"page-header"},Ml={class:"header-left"},Fl={class:"header-info"},Ll={class:"page-title"},Nl={class:"page-subtitle"},zl={class:"header-actions"},Rl={class:"form-container"},Bl={class:"card-header"},ql={class:"card-header"},Al={class:"card-header"},Gl={class:"card-header"},Yl={class:"upload-tip"},Jl={class:"card-header"},Hl={class:"card-header"},Wl=["src","alt"],Ql=ke({__name:"ObjectsFormPage",setup(c){const{t:n}=Le(),$=ct(),k=Ie(),p=Re(),_=Ne(),{confirmLeave:I}=Be(),r=w(),A=w(!1),{canCreate:L,canEdit:N}=ze(),G=w(!1),Y=w(!1),q=w(""),M=w([]),B=w(!1),s=w({title:"",type:"",status:"available",price:0,area:0,rooms:1,bathrooms:1,orientation:"",floor:1,totalFloors:1,buildYear:null,address:"",city:"",district:"",postalCode:"",longitude:null,latitude:null,description:"",facilities:[],contactName:"",contactPhone:"",contactEmail:"",isRecommended:!1,isTop:!1,sortOrder:0,tags:[]}),ne={title:[{required:!0,message:"物件標題為必填項",trigger:"blur"},{min:2,max:100,message:"標題長度在 2 到 100 個字符",trigger:"blur"}],type:[{required:!0,message:"物件類型為必填項",trigger:"change"}],status:[{required:!0,message:"物件狀態為必填項",trigger:"change"}],price:[{required:!0,message:"售價為必填項",trigger:"blur"},{validator:(g,o,y)=>{_e.price.validator(String(o))?y():y(new Error(_e.price.message))},trigger:"blur"}],area:[{required:!0,message:"面積為必填項",trigger:"blur"},{validator:(g,o,y)=>{_e.area.validator(String(o))?y():y(new Error(_e.area.message))},trigger:"blur"}],rooms:[{required:!0,message:"房間數為必填項",trigger:"change"},{type:"number",min:1,max:20,message:"房間數必須在 1-20 之間",trigger:"change"}],bathrooms:[{required:!0,message:"衛生間數為必填項",trigger:"change"},{type:"number",min:1,max:10,message:"衛生間數必須在 1-10 之間",trigger:"change"}],floor:[{type:"number",min:1,max:200,message:"樓層必須在 1-200 之間",trigger:"change"}],totalFloors:[{type:"number",min:1,max:200,message:"總樓層必須在 1-200 之間",trigger:"change"}],address:[{min:5,max:200,message:"地址長度在 5 到 200 個字符",trigger:"blur"}],city:[{min:2,max:50,message:"城市名稱長度在 2 到 50 個字符",trigger:"blur"}],district:[{min:2,max:50,message:"區域名稱長度在 2 到 50 個字符",trigger:"blur"}],postalCode:[{validator:(g,o,y)=>{va(String(o))?y():y(new Error("請輸入正確的郵編"))},trigger:"blur"}],longitude:[{validator:(g,o,y)=>{ha(String(o))?y():y(new Error("請輸入正確的經度（-180 至 180）"))},trigger:"blur"}],latitude:[{validator:(g,o,y)=>{ga(String(o))?y():y(new Error("請輸入正確的緯度（-90 至 90）"))},trigger:"blur"}],contactPhone:[{validator:(g,o,y)=>{_e.phone.validator(String(o))?y():y(new Error(_e.phone.message))},trigger:"blur"}],contactEmail:[{validator:(g,o,y)=>{_e.email.validator(String(o))?y():y(new Error(_e.email.message))},trigger:"blur"}],contactName:[{min:2,max:50,message:"聯繫人姓名長度在 2 到 50 個字符",trigger:"blur"}],description:[{max:2e3,message:"描述不能超過 2000 個字符",trigger:"blur"}]},H=X(()=>!!$.params.id),pe=X(()=>"/api/upload/images"),fe=w([{label:"住宅",value:"residential"},{label:"商業",value:"commercial"},{label:"辦公",value:"office"},{label:"工業",value:"industrial"},{label:"土地",value:"land"}]),z=w([{label:"可售",value:"available"},{label:"已售",value:"sold"},{label:"預留",value:"reserved"},{label:"下架",value:"inactive"}]),be=w([{label:"電梯",value:"elevator"},{label:"停車場",value:"parking"},{label:"游泳池",value:"pool"},{label:"健身房",value:"gym"},{label:"花園",value:"garden"},{label:"陽台",value:"balcony"},{label:"空調",value:"aircon"},{label:"暖氣",value:"heating"}]),f=w(["精裝修","毛坯","學區房","地鐵房","景觀房","南北通透","採光好","交通便利"]),m=async()=>{if(H.value){G.value=!0;try{await p.fetchObject(Number($.params.id));const g=p.currentObject;g&&(Object.assign(s.value,{title:g.name||"",type:g.type||"",status:g.status||"available",price:g.price||0,area:g.area||0,address:g.address||"",description:g.description||"",facilities:g.features||[]}),g.images&&(M.value=g.images.map((o,y)=>({name:`image-${y}`,url:o,uid:y}))),B.value=!1)}catch{_.error("獲取物件信息失敗","載入錯誤")}finally{G.value=!1}}};rt(s,()=>{B.value=!0},{deep:!0});const P=async()=>{if(r.value)try{await r.value.validate(),A.value=!0;const g={name:s.value.title,type:s.value.type,address:s.value.address,area:s.value.area,price:s.value.price,status:s.value.status,description:s.value.description,images:M.value.map(o=>o.url||""),features:s.value.facilities||[]};H.value?(await p.updateObject(Number($.params.id),g),_.success("物件更新成功","保存成功")):(await p.createObject(g),_.success("物件創建成功","創建成功")),B.value=!1,k.push("/objects")}catch(g){if(g!=="validation failed"){const o=(g==null?void 0:g.message)||(H.value?"物件更新失敗":"物件創建失敗");_.error(o,"操作失敗")}}finally{A.value=!1}},x=async()=>{B.value&&!await I()||k.go(-1)},Q=g=>{q.value=g.url,Y.value=!0},le=(g,o)=>{B.value=!0},he=g=>g==null?"":"＄"+String(g).replace(/\B(?=(\d{3})+(?!\d))/g,","),S=g=>g.replace(/[^0-9.]/g,""),V=g=>g==null?"":String(g).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" ㎡",J=g=>g.replace(/[^0-9.]/g,""),oe=g=>{const o=g.type==="image/jpeg"||g.type==="image/png",y=g.size/1024/1024<2;return o?y?!0:(_.error("圖片大小不能超過 2MB!","文件過大"),!1):(_.error("只能上傳 JPG/PNG 格式的圖片!","格式錯誤"),!1)},je=async()=>B.value?await I():!0,re=w("left"),ve=()=>{re.value=window.innerWidth<768?"top":"left"};return Se(async()=>{ve(),window.addEventListener("resize",ve),await pa(),await m()}),Se(()=>{}),ma(()=>{window.removeEventListener("resize",ve)}),fa(je),(g,o)=>{const y=we,W=Ve,Z=Qe,O=Ut,C=nt,E=Xe,b=Ke,v=et,D=Pt,R=st,ee=De,F=lt,se=Mt,ge=Lt,xe=Nt,Ce=Bt,te=At,$e=He,ye=at;return h(),T("div",Dl,[l("div",Il,[l("div",Ml,[e(W,{type:"text",onClick:x,class:"back-button"},{default:t(()=>[e(y,null,{default:t(()=>[e(a(ot))]),_:1}),j(" "+u(a(n)("common.back")),1)]),_:1}),l("div",Fl,[l("h1",Ll,u(H.value?a(n)("objects.form.dialog_title_edit"):a(n)("objects.form.dialog_title_create")),1),l("div",Nl,u(H.value?`${a(n)("objects.actions.edit")} ${s.value.title||a(n)("objects.detail.title_fallback")}`:a(n)("objects.form.create_subtitle")),1)])]),l("div",zl,[e(W,{onClick:x},{default:t(()=>[j(u(a(n)("common.cancel")),1)]),_:1}),(H.value?a(N)("objects"):a(L)("objects"))?(h(),U(W,{key:0,type:"primary",onClick:P,loading:A.value},{default:t(()=>[e(y,null,{default:t(()=>[e(a(St))]),_:1}),j(" "+u(H.value?a(n)("common.save"):a(n)("objects.form.submit_create")),1)]),_:1},8,["loading"])):ae("",!0)])]),l("div",Rl,[it((h(),U(te,{ref_key:"formRef",ref:r,model:s.value,rules:ne,"label-width":"100px","label-position":re.value},{default:t(()=>[e(R,{gutter:24},{default:t(()=>[e(C,{lg:16,md:24},{default:t(()=>[e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",Bl,[e(y,null,{default:t(()=>[e(a(Dt))]),_:1}),o[28]||(o[28]=l("span",null,"基本信息",-1))])]),default:t(()=>[e(R,{gutter:16},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(O,{label:a(n)("objects.form.name"),prop:"title"},{default:t(()=>[e(Z,{modelValue:s.value.title,"onUpdate:modelValue":o[0]||(o[0]=i=>s.value.title=i),placeholder:a(n)("objects.form.name_placeholder"),maxlength:"100","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.form.type"),prop:"type"},{default:t(()=>[e(b,{modelValue:s.value.type,"onUpdate:modelValue":o[1]||(o[1]=i=>s.value.type=i),placeholder:a(n)("objects.form.type_placeholder"),style:{width:"100%"}},{default:t(()=>[(h(!0),T(de,null,ue(fe.value,i=>(h(),U(E,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.table.status"),prop:"status"},{default:t(()=>[e(b,{modelValue:s.value.status,"onUpdate:modelValue":o[2]||(o[2]=i=>s.value.status=i),placeholder:a(n)("objects.table.status"),style:{width:"100%"}},{default:t(()=>[(h(!0),T(de,null,ue(z.value,i=>(h(),U(E,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.detail.sale_price"),prop:"price"},{default:t(()=>[e(v,{modelValue:s.value.price,"onUpdate:modelValue":o[3]||(o[3]=i=>s.value.price=i),min:0,max:999999999,precision:2,formatter:he,parser:S,"controls-position":"right",placeholder:a(n)("objects.form.price_placeholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.detail.area"),prop:"area"},{default:t(()=>[e(v,{modelValue:s.value.area,"onUpdate:modelValue":o[4]||(o[4]=i=>s.value.area=i),min:0,max:99999,precision:2,formatter:V,parser:J,"controls-position":"right",placeholder:a(n)("objects.form.area_placeholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.rooms"),prop:"rooms"},{default:t(()=>[e(v,{modelValue:s.value.rooms,"onUpdate:modelValue":o[5]||(o[5]=i=>s.value.rooms=i),min:0,max:20,placeholder:a(n)("objects.form.rooms"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.bathrooms"),prop:"bathrooms"},{default:t(()=>[e(v,{modelValue:s.value.bathrooms,"onUpdate:modelValue":o[6]||(o[6]=i=>s.value.bathrooms=i),min:0,max:10,placeholder:a(n)("objects.form.bathrooms"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.orientation"),prop:"orientation"},{default:t(()=>[e(b,{modelValue:s.value.orientation,"onUpdate:modelValue":o[7]||(o[7]=i=>s.value.orientation=i),placeholder:a(n)("objects.form.orientation"),style:{width:"100%"}},{default:t(()=>[e(E,{label:"東",value:"east"}),e(E,{label:"南",value:"south"}),e(E,{label:"西",value:"west"}),e(E,{label:"北",value:"north"}),e(E,{label:"東南",value:"southeast"}),e(E,{label:"西南",value:"southwest"}),e(E,{label:"東北",value:"northeast"}),e(E,{label:"西北",value:"northwest"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.form.floor"),prop:"floor"},{default:t(()=>[e(v,{modelValue:s.value.floor,"onUpdate:modelValue":o[8]||(o[8]=i=>s.value.floor=i),min:1,max:200,placeholder:a(n)("objects.form.floor_placeholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.form.total_floors"),prop:"totalFloors"},{default:t(()=>[e(v,{modelValue:s.value.totalFloors,"onUpdate:modelValue":o[9]||(o[9]=i=>s.value.totalFloors=i),min:1,max:200,placeholder:a(n)("objects.form.total_floors_placeholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:24},{default:t(()=>[e(O,{label:a(n)("objects.form.build_year"),prop:"buildYear"},{default:t(()=>[e(D,{modelValue:s.value.buildYear,"onUpdate:modelValue":o[10]||(o[10]=i=>s.value.buildYear=i),type:"year",placeholder:a(n)("objects.form.build_year_placeholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",ql,[e(y,null,{default:t(()=>[e(a(It))]),_:1}),o[29]||(o[29]=l("span",null,"位置信息",-1))])]),default:t(()=>[e(R,{gutter:16},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(O,{label:a(n)("objects.detail.address"),prop:"address"},{default:t(()=>[e(Z,{modelValue:s.value.address,"onUpdate:modelValue":o[11]||(o[11]=i=>s.value.address=i),placeholder:a(n)("objects.form.address_placeholder"),maxlength:"200"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.city"),prop:"city"},{default:t(()=>[e(Z,{modelValue:s.value.city,"onUpdate:modelValue":o[12]||(o[12]=i=>s.value.city=i),placeholder:a(n)("objects.form.city_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.district"),prop:"district"},{default:t(()=>[e(Z,{modelValue:s.value.district,"onUpdate:modelValue":o[13]||(o[13]=i=>s.value.district=i),placeholder:a(n)("objects.form.district_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:8},{default:t(()=>[e(O,{label:a(n)("objects.form.postal_code"),prop:"postalCode"},{default:t(()=>[e(Z,{modelValue:s.value.postalCode,"onUpdate:modelValue":o[14]||(o[14]=i=>s.value.postalCode=i),placeholder:a(n)("objects.form.postal_code_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.form.longitude"),prop:"longitude"},{default:t(()=>[e(v,{modelValue:s.value.longitude,"onUpdate:modelValue":o[15]||(o[15]=i=>s.value.longitude=i),precision:6,placeholder:a(n)("objects.form.longitude"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(C,{span:12},{default:t(()=>[e(O,{label:a(n)("objects.form.latitude"),prop:"latitude"},{default:t(()=>[e(v,{modelValue:s.value.latitude,"onUpdate:modelValue":o[16]||(o[16]=i=>s.value.latitude=i),precision:6,placeholder:a(n)("objects.form.latitude"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",Al,[e(y,null,{default:t(()=>[e(a(Ft))]),_:1}),o[30]||(o[30]=l("span",null,"詳細描述",-1))])]),default:t(()=>[e(O,{label:a(n)("objects.detail.description"),prop:"description"},{default:t(()=>[e(Z,{modelValue:s.value.description,"onUpdate:modelValue":o[17]||(o[17]=i=>s.value.description=i),type:"textarea",rows:6,placeholder:a(n)("objects.form.description_placeholder"),maxlength:"1000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(O,{label:"配套設施"},{default:t(()=>[e(se,{modelValue:s.value.facilities,"onUpdate:modelValue":o[18]||(o[18]=i=>s.value.facilities=i)},{default:t(()=>[(h(!0),T(de,null,ue(be.value,i=>(h(),U(F,{key:i.value,label:i.value},{default:t(()=>[j(u(i.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{lg:8,md:24},{default:t(()=>[e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",Gl,[e(y,null,{default:t(()=>[e(a(zt))]),_:1}),o[31]||(o[31]=l("span",null,"物件圖片",-1))])]),default:t(()=>[e(ge,{"file-list":M.value,"onUpdate:fileList":o[19]||(o[19]=i=>M.value=i),action:pe.value,"list-type":"picture-card","on-preview":Q,"on-remove":le,"before-upload":oe,multiple:"",limit:10},{default:t(()=>[e(y,null,{default:t(()=>[e(a(Fe))]),_:1})]),_:1},8,["file-list","action"]),l("div",Yl,[e(xe,{size:"small",type:"info"},{default:t(()=>[...o[32]||(o[32]=[j(" 支持 JPG、PNG 格式，單個文件不超過 2MB，最多上傳 10 張圖片 ",-1)])]),_:1})])]),_:1}),e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",Jl,[e(y,null,{default:t(()=>[e(a(Rt))]),_:1}),o[33]||(o[33]=l("span",null,"聯繫信息",-1))])]),default:t(()=>[e(O,{label:"聯繫人",prop:"contactName"},{default:t(()=>[e(Z,{modelValue:s.value.contactName,"onUpdate:modelValue":o[20]||(o[20]=i=>s.value.contactName=i),placeholder:"請輸入聯繫人姓名"},null,8,["modelValue"])]),_:1}),e(O,{label:"聯繫電話",prop:"contactPhone"},{default:t(()=>[e(Z,{modelValue:s.value.contactPhone,"onUpdate:modelValue":o[21]||(o[21]=i=>s.value.contactPhone=i),placeholder:"請輸入聯繫電話"},null,8,["modelValue"])]),_:1}),e(O,{label:"聯繫郵箱",prop:"contactEmail"},{default:t(()=>[e(Z,{modelValue:s.value.contactEmail,"onUpdate:modelValue":o[22]||(o[22]=i=>s.value.contactEmail=i),placeholder:"請輸入聯繫郵箱"},null,8,["modelValue"])]),_:1})]),_:1}),e(ee,{class:"form-card",shadow:"hover"},{header:t(()=>[l("div",Hl,[e(y,null,{default:t(()=>[e(a(qt))]),_:1}),o[34]||(o[34]=l("span",null,"其他設置",-1))])]),default:t(()=>[e(O,{label:"是否推薦"},{default:t(()=>[e(Ce,{modelValue:s.value.isRecommended,"onUpdate:modelValue":o[23]||(o[23]=i=>s.value.isRecommended=i),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(O,{label:"是否置頂"},{default:t(()=>[e(Ce,{modelValue:s.value.isTop,"onUpdate:modelValue":o[24]||(o[24]=i=>s.value.isTop=i),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(O,{label:"排序權重"},{default:t(()=>[e(v,{modelValue:s.value.sortOrder,"onUpdate:modelValue":o[25]||(o[25]=i=>s.value.sortOrder=i),min:0,max:999,placeholder:"數值越大越靠前",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(O,{label:"標籤"},{default:t(()=>[e(b,{modelValue:s.value.tags,"onUpdate:modelValue":o[26]||(o[26]=i=>s.value.tags=i),multiple:"",filterable:"","allow-create":"",placeholder:"請選擇或輸入標籤",style:{width:"100%"}},{default:t(()=>[(h(!0),T(de,null,ue(f.value,i=>(h(),U(E,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-position"])),[[ye,G.value]])]),e($e,{modelValue:Y.value,"onUpdate:modelValue":o[27]||(o[27]=i=>Y.value=i),title:"圖片預覽",width:"80%",center:""},{default:t(()=>[q.value?(h(),T("img",{key:0,src:q.value,alt:a(n)("objects.detail.preview_title"),style:{width:"100%","max-height":"70vh","object-fit":"contain"}},null,8,Wl)):ae("",!0)]),_:1},8,["modelValue"])])}}}),Zl=Oe(Ql,[["__scopeId","data-v-0c407915"]]),zo=Object.freeze(Object.defineProperty({__proto__:null,default:Zl},Symbol.toStringTag,{value:"Module"})),Kl={class:"object-detail-page"},Xl={class:"page-header"},eo={class:"header-left"},to={class:"header-info"},ao={class:"page-title"},lo={class:"object-status"},oo={class:"header-actions"},so={key:0,class:"loading-container"},no={key:1,class:"object-content"},ro={class:"card-header"},io={class:"image-gallery"},co={key:0},uo=["src","alt","onClick"],po={class:"image-thumbnails"},mo=["onClick"],_o=["src","alt"],fo={key:1,class:"no-images"},bo={class:"description-content"},vo={key:0},go={class:"location-content"},ho={class:"price"},jo={key:2,class:"error-container"},yo=ke({__name:"ObjectsDetailPage",setup(c){const n=Ue(()=>Te(()=>import("./ImagePreviewDialog-DpDVHOoq.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,18]))),$=Ue(()=>Te(()=>import("./ImageUploadDialog-Duq3Gg7a.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,20]))),k=ct(),{t:p}=Le(),_=Ie(),I=Re(),r=Ne(),{confirmDelete:A}=Be(),L=w(!1),{canEdit:N,canDelete:G}=ze(),Y=w(!1),q=w(!1),M=w(null),B=w([]),s=X(()=>I.currentObject),ne=X(()=>`/api/objects/${k.params.id}/images`),H=async()=>{L.value=!0;try{await I.fetchObject(Number(k.params.id))}catch(S){console.error("獲取物件信息失敗:",S),r.error("獲取物件信息失敗","載入錯誤")}finally{L.value=!1}},pe=()=>{_.push(`/objects/${k.params.id}/edit`)},fe=async S=>{switch(S){case"duplicate":await z();break;case"share":be();break;case"export":f();break;case"delete":await m();break}},z=async()=>{r.info("物件複製功能開發中...","功能提示")},be=()=>{const S=window.location.href;navigator.clipboard.writeText(S).then(()=>{r.success("鏈接已複製到剪貼板")}).catch(()=>{r.error("複製失敗，請手動複製鏈接")})},f=()=>{try{r.info("導出功能開發中...","功能提示")}catch{r.error("導出失敗","操作失敗")}},m=async()=>{var V;if(await A(((V=s.value)==null?void 0:V.name)||"此物件"))try{await I.deleteObject(Number(k.params.id)),r.success("物件刪除成功"),_.push("/objects")}catch(J){console.error("物件刪除失敗:",J),r.error("物件刪除失敗","操作失敗")}},P=S=>{M.value=S,Y.value=!0},x=S=>{const V=S.type==="image/jpeg"||S.type==="image/png",J=S.size/1024/1024<2;return V?J?!0:(r.error(p("objects.detail.max_2mb")),!1):(r.error(p("objects.detail.only_jpg_png")),!1)},Q=S=>{r.success(p("objects.detail.upload_success")),H()},le=S=>({available:"success",sold:"info",reserved:"warning",inactive:"danger"})[S]||"info",he=S=>({available:p("objects.detail.status.available"),sold:p("objects.detail.status.sold"),reserved:p("objects.detail.status.reserved"),inactive:p("objects.detail.status.inactive")})[S]||p("objects.unknown");return Se(()=>{H()}),(S,V)=>{var R,ee;const J=we,oe=Ve,je=tt,re=Ht,ve=Jt,g=Kt,o=Xt,y=ta,W=ea,Z=aa,O=De,C=oa,E=la,b=nt,v=st,D=sa;return h(),T("div",Kl,[l("div",Xl,[l("div",eo,[e(oe,{type:"text",onClick:V[0]||(V[0]=F=>a(_).back()),class:"back-button"},{default:t(()=>[e(J,null,{default:t(()=>[e(a(ot))]),_:1}),V[6]||(V[6]=j(" 返回 ",-1))]),_:1}),l("div",to,[l("h1",ao,u(((R=s.value)==null?void 0:R.name)||"物件詳情"),1),l("div",lo,[e(je,{type:le(((ee=s.value)==null?void 0:ee.status)||"inactive"),size:"large"},{default:t(()=>{var F;return[j(u(he(((F=s.value)==null?void 0:F.status)||"inactive")),1)]}),_:1},8,["type"])])])]),l("div",oo,[a(N)("objects")?(h(),U(oe,{key:0,type:"primary",onClick:pe,loading:L.value},{default:t(()=>[e(J,null,{default:t(()=>[e(a(Gt))]),_:1}),j(" "+u(a(p)("objects.actions.edit")),1)]),_:1},8,["loading"])):ae("",!0),e(g,{onCommand:fe},{dropdown:t(()=>[e(ve,null,{default:t(()=>[e(re,{command:"duplicate"},{default:t(()=>[e(J,null,{default:t(()=>[e(a(Wt))]),_:1}),j(" "+u(a(p)("objects.detail.duplicate")),1)]),_:1}),e(re,{command:"share"},{default:t(()=>[e(J,null,{default:t(()=>[e(a(Qt))]),_:1}),j(" "+u(a(p)("objects.detail.share")),1)]),_:1}),e(re,{command:"export"},{default:t(()=>[e(J,null,{default:t(()=>[e(a(We))]),_:1}),j(" "+u(a(p)("objects.detail.export")),1)]),_:1}),a(G)("objects")?(h(),U(re,{key:0,command:"delete",divided:"",class:"danger-item"},{default:t(()=>[e(J,null,{default:t(()=>[e(a(Zt))]),_:1}),j(" "+u(a(p)("objects.detail.delete")),1)]),_:1})):ae("",!0)]),_:1})]),default:t(()=>[e(oe,null,{default:t(()=>[j(u(a(p)("objects.detail.more_actions"))+" ",1),e(J,{class:"el-icon--right"},{default:t(()=>[e(a(Yt))]),_:1})]),_:1})]),_:1})])]),L.value?(h(),T("div",so,[e(o,{rows:8,animated:""})])):s.value?(h(),T("div",no,[e(v,{gutter:24},{default:t(()=>[e(b,{lg:16,md:24},{default:t(()=>[e(O,{class:"image-card",shadow:"hover"},{header:t(()=>[l("div",ro,[V[7]||(V[7]=l("span",null,"物件圖片",-1)),e(oe,{type:"text",onClick:V[1]||(V[1]=F=>q.value=!0)},{default:t(()=>[e(J,null,{default:t(()=>[e(a(Fe))]),_:1}),j(" "+u(a(p)("objects.detail.add_image")),1)]),_:1})])]),default:t(()=>[l("div",io,[s.value.images&&s.value.images.length>0?(h(),T("div",co,[e(W,{height:400,"indicator-position":"outside",arrow:"hover"},{default:t(()=>[(h(!0),T(de,null,ue(s.value.images,(F,se)=>(h(),U(y,{key:se},{default:t(()=>[l("img",{src:F,alt:s.value.name,class:"carousel-image",onClick:ge=>P(F)},null,8,uo)]),_:2},1024))),128))]),_:1}),l("div",po,[(h(!0),T(de,null,ue(s.value.images,(F,se)=>(h(),T("div",{key:se,class:"thumbnail",onClick:ge=>P(F)},[l("img",{src:F,alt:s.value.name},null,8,_o)],8,mo))),128))])])):(h(),T("div",fo,[e(Z,{description:"{{ t('objects.detail.no_image') }}"}),e(oe,{type:"primary",onClick:V[2]||(V[2]=F=>q.value=!0)},{default:t(()=>[...V[8]||(V[8]=[j(" 上傳圖片 ",-1)])]),_:1})]))])]),_:1}),e(O,{class:"description-card",shadow:"hover"},{header:t(()=>[l("span",null,u(a(p)("objects.detail.description")),1)]),default:t(()=>[l("div",bo,[s.value.description?(h(),T("p",vo,u(s.value.description),1)):(h(),U(Z,{key:1,description:"{{ t('objects.detail.no_description') }}"}))])]),_:1}),e(O,{class:"location-card",shadow:"hover"},{header:t(()=>[...V[9]||(V[9]=[l("span",null,"位置信息",-1)])]),default:t(()=>[l("div",go,[e(E,{column:1,border:""},{default:t(()=>[e(C,{label:"{{ t('objects.detail.address') }}"},{default:t(()=>[j(u(s.value.address||a(p)("objects.detail.not_provided")),1)]),_:1})]),_:1})])]),_:1})]),_:1}),e(b,{lg:8,md:24},{default:t(()=>[e(O,{class:"info-card",shadow:"hover"},{header:t(()=>[...V[10]||(V[10]=[l("span",null,"基本信息",-1)])]),default:t(()=>[e(E,{column:1,border:""},{default:t(()=>[e(C,{label:"{{ t('objects.detail.id') }}"},{default:t(()=>[j(u(s.value.id),1)]),_:1}),e(C,{label:"{{ t('objects.detail.category') }}"},{default:t(()=>[j(u(s.value.type||"未分類"),1)]),_:1}),e(C,{label:"{{ t('objects.detail.sale_price') }}"},{default:t(()=>[l("span",ho,u(a(Je)(s.value.price)),1)]),_:1}),e(C,{label:"{{ t('objects.detail.area') }}"},{default:t(()=>[j(u(s.value.area)+"㎡ ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):(h(),T("div",jo,[e(D,{icon:"warning",title:a(p)("objects.detail.not_found_title"),"sub-title":a(p)("objects.detail.not_found_subtitle")},{extra:t(()=>[e(oe,{type:"primary",onClick:V[3]||(V[3]=F=>a(_).push("/objects"))},{default:t(()=>[j(u(a(p)("objects.list_title")),1)]),_:1})]),_:1},8,["title","sub-title"])])),e(Ye,null,{default:t(()=>[(h(),U(Pe,null,{default:t(()=>{var F;return[e(a(n),{modelValue:Y.value,"onUpdate:modelValue":V[4]||(V[4]=se=>Y.value=se),title:a(p)("objects.detail.preview_title"),"image-url":M.value,alt:((F=s.value)==null?void 0:F.name)||a(p)("objects.detail.images")},null,8,["modelValue","title","image-url","alt"])]}),fallback:t(()=>[e(Ge,{fullscreen:""})]),_:1}))]),_:1}),e(Ye,null,{default:t(()=>[(h(),U(Pe,null,{default:t(()=>[e(a($),{modelValue:q.value,"onUpdate:modelValue":V[5]||(V[5]=F=>q.value=F),title:a(p)("objects.detail.upload_title"),"upload-url":ne.value,"before-upload":x,"on-success":Q,"file-list":B.value},null,8,["modelValue","title","upload-url","file-list"])]),fallback:t(()=>[e(Ge,{fullscreen:""})]),_:1}))]),_:1})])}}}),wo=Oe(yo,[["__scopeId","data-v-f9d2db8b"]]),Ro=Object.freeze(Object.defineProperty({__proto__:null,default:wo},Symbol.toStringTag,{value:"Module"})),Vo={class:"objects-dev-page"},ko={class:"dev-actions"},Oo={class:"action-icon create"},xo={class:"action-content"},Co={class:"action-icon search"},$o={class:"action-content"},Eo=ke({__name:"ObjectsDevPage",setup(c){const n=Ie(),$=()=>n.push("/objects/create"),k=()=>n.push("/objects");return(p,_)=>{const I=na,r=we,A=Ve,L=De;return h(),T("div",Vo,[e(I,{content:"物件開發"}),l("div",ko,[e(L,{class:"action-card",shadow:"hover",onClick:$},{default:t(()=>[l("div",Oo,[e(r,null,{default:t(()=>[e(a(ra))]),_:1})]),l("div",xo,[_[1]||(_[1]=l("h3",null,"新增物件",-1)),_[2]||(_[2]=l("p",null,"建立新的不動產物件，填寫基本資訊、價格、面積、特色等。",-1)),e(A,{type:"primary",text:""},{default:t(()=>[..._[0]||(_[0]=[j("前往新增",-1)])]),_:1})])]),_:1}),e(L,{class:"action-card",shadow:"hover",onClick:k},{default:t(()=>[l("div",Co,[e(r,null,{default:t(()=>[e(a(Ze))]),_:1})]),l("div",$o,[_[4]||(_[4]=l("h3",null,"查詢物件",-1)),_[5]||(_[5]=l("p",null,"進入物件列表，可使用關鍵字與條件篩選，查看與管理既有物件。",-1)),e(A,{type:"primary",text:""},{default:t(()=>[..._[3]||(_[3]=[j("前往查詢",-1)])]),_:1})])]),_:1})])])}}}),To=Oe(Eo,[["__scopeId","data-v-314d26f6"]]),Bo=Object.freeze(Object.defineProperty({__proto__:null,default:To},Symbol.toStringTag,{value:"Module"}));export{No as O,zo as a,Ro as b,Bo as c,Be as u};
