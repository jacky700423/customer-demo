var je=Object.defineProperty;var Ie=(t,e,s)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Q=(t,e,s)=>Ie(t,typeof e!="symbol"?e+"":e,s);import{c as ve,d as Ce,i as Oe,e as De,w as ze,f as Ue,g as Ne,h as de,j as ce,u as Ee,l as re,k as Se,m as pe,n as fe,o as C,p as xe,q as Fe,r as qe,s as Ge,t as Le,v as Me,x as We,y as Ze,z as Ve,A as Be,B as Je,C as He,D as Ke,F as Qe,G as Ye,b as Xe}from"./ui-B8MTJjzS.js";import{aY as ne,b2 as E,b3 as we,b4 as et,b5 as oe,a_ as A,a$ as n,b0 as d,aZ as z,b6 as $e,b7 as tt,b8 as Pe,b1 as c,b9 as B,ba as st,bb as L,bc as V,bd as rt,be as ot,bf as at,bg as J,bh as H,bi as he,bj as nt,bk as T,bl as ye,bm as lt}from"./vendor-other-DMrNeO-R.js";import{d as it,u as be,a as Ae}from"./vendor-C-KThoNQ.js";import{_ as le}from"./page-admin-Txqa2T3a.js";import{a as ut}from"./utils-nO-s2RVl.js";const dt={class:"toast-icon"},ct={class:"toast-content"},pt={key:0,class:"toast-title"},ft={class:"toast-message"},gt=["onClick"],mt=ne({__name:"MessageToast",setup(t,{expose:e}){const s=E([]),u=new Map,l=r=>({success:Ue,warning:ze,error:De,info:Oe})[r],_=r=>{const a=Date.now().toString()+Math.random().toString(36).substr(2,9),f={id:a,duration:3e3,closable:!0,...r};if(s.value.push(f),f.duration&&f.duration>0){const v=setTimeout(()=>{p(a)},f.duration);u.set(a,v)}},p=r=>{const a=s.value.findIndex(v=>v.id===r);a>-1&&s.value.splice(a,1);const f=u.get(r);f&&(clearTimeout(f),u.delete(r))};return e({addToast:_,removeToast:p,clearAll:()=>{s.value=[],u.forEach(r=>clearTimeout(r)),u.clear()}}),we(()=>{s.value=[]}),et(()=>{u.forEach(r=>clearTimeout(r)),u.clear()}),(r,a)=>{const f=ve;return A(),oe(ot,{to:"body"},[n(rt,{name:"toast",tag:"div",class:"toast-container"},{default:d(()=>[(A(!0),z($e,null,tt(s.value,v=>(A(),z("div",{key:v.id,class:Pe(["toast-item",`toast-${v.type}`,{"toast-closable":v.closable}])},[c("div",dt,[n(f,{size:20},{default:d(()=>[(A(),oe(st(l(v.type))))]),_:2},1024)]),c("div",ct,[v.title?(A(),z("div",pt,L(v.title),1)):B("",!0),c("div",ft,L(v.message),1)]),v.closable?(A(),z("div",{key:0,class:"toast-close",onClick:k=>p(v.id)},[n(f,{size:16},{default:d(()=>[n(V(Ce))]),_:1})],8,gt)):B("",!0)],2))),128))]),_:1})])}}}),_t=le(mt,[["__scopeId","data-v-5c222085"]]);let me=null,Te=null;const vt=()=>{if(!me){const t=document.createElement("div");document.body.appendChild(t),me=at(_t),me.use(Ne),Te=me.mount(t)}return Te},se=()=>{const t=vt(),e=g=>{t.addToast(g)};return{showToast:e,success:(g,r,a)=>{e({type:"success",message:g,title:r,...a})},error:(g,r,a)=>{e({type:"error",message:g,title:r,duration:5e3,...a})},warning:(g,r,a)=>{e({type:"warning",message:g,title:r,...a})},info:(g,r,a)=>{e({type:"info",message:g,title:r,...a})},clearAll:()=>{t.clearAll()}}},_s={success:(t,e,s)=>{se().success(t,e,s)},error:(t,e,s)=>{se().error(t,e,s)},warning:(t,e,s)=>{se().warning(t,e,s)},info:(t,e,s)=>{se().info(t,e,s)},clearAll:()=>{se().clearAll()}};class wt{constructor(){Q(this,"queue",[]);Q(this,"isReporting",!1);Q(this,"maxQueueSize",50);Q(this,"reportInterval",5e3);Q(this,"sessionId");this.sessionId=this.generateSessionId(),this.setupGlobalErrorHandlers(),this.startReportingLoop()}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{var s;this.reportError({message:e.message,stack:(s=e.error)==null?void 0:s.stack,url:e.filename||window.location.href,userAgent:navigator.userAgent,timestamp:Date.now(),level:"error",category:"javascript",metadata:{lineno:e.lineno,colno:e.colno,filename:e.filename}})}),window.addEventListener("unhandledrejection",e=>{var s,u;this.reportError({message:((s=e.reason)==null?void 0:s.message)||"Unhandled Promise Rejection",stack:(u=e.reason)==null?void 0:u.stack,url:window.location.href,userAgent:navigator.userAgent,timestamp:Date.now(),level:"error",category:"javascript",metadata:{reason:e.reason}})}),window.addEventListener("error",e=>{if(e.target!==window){const s=e.target;this.reportError({message:`Resource load error: ${s.tagName}`,url:window.location.href,userAgent:navigator.userAgent,timestamp:Date.now(),level:"error",category:"network",metadata:{tagName:s.tagName,src:s.src||s.href,outerHTML:s.outerHTML}})}},!0)}reportError(e){const s={message:e.message||"Unknown error",stack:e.stack,url:e.url||window.location.href,userAgent:e.userAgent||navigator.userAgent,timestamp:e.timestamp||Date.now(),level:e.level||"error",category:e.category||"javascript",sessionId:this.sessionId,userId:this.getCurrentUserId(),metadata:e.metadata};this.queue.push(s),this.queue.length>this.maxQueueSize&&this.queue.shift(),e.level==="error"&&this.sendReports()}reportApiError(e,s,u){var l,_;this.reportError({message:`API Error: ${u} ${s}`,stack:e.stack,level:"error",category:"api",metadata:{url:s,method:u,status:e.status,response:(l=e.response)==null?void 0:l.data,requestData:(_=e.config)==null?void 0:_.data}})}reportUserError(e,s){this.reportError({message:e,level:"warning",category:"user",metadata:s})}reportPerformanceIssue(e,s){this.reportError({message:e,level:"warning",category:"javascript",metadata:{...s,performance:{memory:performance.memory,timing:performance.timing,navigation:performance.navigation}}})}getCurrentUserId(){try{const e=localStorage.getItem("user_info");if(e)return JSON.parse(e).id}catch{}}async sendReports(){if(!(this.isReporting||this.queue.length===0)){this.isReporting=!0;try{const e=[...this.queue];this.queue=[],await D.post("/api/errors/report",{reports:e,environment:"production",version:"1.0.0"}),console.log(`Sent ${e.length} error reports`)}catch(e){console.error("Failed to send error reports:",e),this.queue.unshift(...this.queue)}finally{this.isReporting=!1}}}startReportingLoop(){setInterval(()=>{this.sendReports()},this.reportInterval)}flush(){return this.sendReports()}clear(){this.queue=[]}getQueueStatus(){return{queueSize:this.queue.length,isReporting:this.isReporting,sessionId:this.sessionId}}}const ht=new wt,ke=(t,e,s)=>{ht.reportApiError(t,e,s)},Y=String(void 0)==="true";function X(t,e=300){return new Promise(s=>setTimeout(()=>s(t),e))}function w(t,e){return{success:!0,data:t,message:e}}const $=new Date,x=t=>t.toISOString(),ie={id:1,name:"Demo Admin",email:"admin@demo.local",role:"admin",permissions:["dashboard:view","objects:view","objects:create","objects:edit","objects:delete","opportunities:view","opportunities:create","opportunities:edit","opportunities:delete","investors:view","investors:create","investors:edit","investors:delete","files:view","files:upload","files:delete","files:categories:manage","profile:view","performance:view"]},ae=["Residential","Commercial","Industrial","Land"],ue=["available","sold","reserved","inactive"],S=Array.from({length:25}).map((t,e)=>({id:e+1,name:`Demo Object #${e+1}`,type:ae[e%ae.length],address:`No.${e+1}, Demo Street, Demo City`,area:50+e%10*10,price:2e5+e*5e3,status:ue[e%ue.length],description:"This is a demo real estate object",images:[],features:["Elevator","Parking","24/7 Security"].slice(0,e%3+1),created_at:x(new Date($.getTime()-e*864e5)),updated_at:x(new Date($.getTime()-e*432e5))})),I=Array.from({length:12}).map((t,e)=>({id:e+1,name:`Investor ${e+1}`,email:`investor${e+1}@demo.local`,phone:`+1-202-000-${String(1e3+e)}`,company:`Demo Capital ${e+1}`,investment_capacity:1e6+e*5e4,available_capital:5e5+e*25e3,preferred_types:ae.slice(0,e%ae.length+1),status:e%5===0?"inactive":"active",created_at:x(new Date($.getTime()-e*1728e5)),updated_at:x(new Date($.getTime()-e*864e5))})),N=Array.from({length:18}).map((t,e)=>({id:e+1,title:`Opportunity ${e+1}`,description:"Demo opportunity",object_id:e%S.length+1,investor_id:e%I.length+1,status:["new","in_progress","completed","cancelled"][e%4],priority:["low","medium","high"][e%3],estimated_value:1e5+e*8e3,probability:20+e%6*10,expected_close_date:x(new Date($.getTime()+e%6*864e5)),notes:e%3===0?"Follow up next week":void 0,created_at:x(new Date($.getTime()-e*2592e5)),updated_at:x(new Date($.getTime()-e*1296e5)),object:S[e%S.length],investor:I[e%I.length]})),G=Array.from({length:20}).map((t,e)=>({id:e+1,name:`document_${e+1}.pdf`,original_name:`Original Document ${e+1}.pdf`,path:`/uploads/document_${e+1}.pdf`,size:1024*(e+10),mime_type:"application/pdf",category:e%2===0?"contracts":"images",related_type:e%3===0?"object":"opportunity",related_id:e+1,uploaded_by:1,created_at:x(new Date($.getTime()-e*36e5))})),yt=[{id:"contracts",name:"Contracts",description:"Contract files",allowed_types:["pdf","docx"],max_size:20*1024*1024},{id:"images",name:"Images",description:"Image files",allowed_types:["jpg","png"],max_size:10*1024*1024},{id:"reports",name:"Reports",description:"Report files",allowed_types:["pdf","xlsx"],max_size:50*1024*1024}];function _e(t,e=1,s=10){const u=t.length,l=Math.max(1,Math.ceil(u/s)),_=Math.min(Math.max(1,e),l),p=(_-1)*s,g=p+s;return{data:t.slice(p,g),current_page:_,last_page:l,per_page:s,total:u,from:p+1,to:Math.min(g,u)}}function bt(t,e,s="Series",u="#409EFF"){return{labels:t,datasets:[{label:s,data:e,borderColor:u,fill:!1}]}}const ee={async get(t,e){return X(te("GET",t,e))},async post(t,e){return X(te("POST",t,void 0,e))},async put(t,e){return X(te("PUT",t,void 0,e))},async patch(t,e){return X(te("PATCH",t,void 0,e))},async delete(t,e){return X(te("DELETE",t,void 0,e))},async upload(t,e){return X(te("POST",t))}};function te(t,e,s,u){var g;const[l="",_=""]=e.split("?"),p=new URLSearchParams(_||"");if(l==="/auth/login"&&t==="POST"){const r="demo-token";return localStorage.setItem("auth_token",r),localStorage.setItem("user_info",JSON.stringify(ie)),w({token:r,expires_in:3600,user:ie})}if(l==="/auth/logout"&&t==="POST")return localStorage.removeItem("auth_token"),localStorage.removeItem("user_info"),w({});if(l==="/auth/me"&&t==="GET")return w(ie);if(l==="/auth/refresh"&&t==="POST")return w({token:"demo-token",expires_in:3600});if(l.startsWith("/auth/")&&["POST","PUT"].includes(t))return w({});if(l==="/dashboard/stats"&&t==="GET"){const r={total_objects:S.length,available_objects:S.filter(a=>a.status==="available").length,total_opportunities:N.length,active_opportunities:N.filter(a=>a.status==="in_progress").length,total_investors:I.length,active_investors:I.filter(a=>a.status==="active").length,monthly_revenue:12e4,conversion_rate:32};return w(r)}if(l==="/dashboard/revenue-chart"&&t==="GET"){const r=Number((s==null?void 0:s.months)??p.get("months")??12),a=Array.from({length:r}).map((v,k)=>`M${k+1}`),f=a.map((v,k)=>50+k%6*10);return w(bt(a,f,"Revenue","#67C23A"))}if(l==="/dashboard/object-status-chart"&&t==="GET"){const r=ue,a=r.map(f=>S.filter(v=>v.status===f).length);return w({labels:r,datasets:[{label:"Objects",data:a}]})}if(l==="/dashboard/opportunity-funnel-chart"&&t==="GET")return w({labels:["Visits","Leads","Qualified","Proposals","Won"],datasets:[{label:"Funnel",data:[1e3,400,200,90,30]}]});if(l==="/dashboard/recent-activities"&&t==="GET"){const r=Number((s==null?void 0:s.limit)??p.get("limit")??10),a=Array.from({length:r}).map((f,v)=>({id:v+1,type:["login","create","update","delete"][v%4],title:`Activity #${v+1}`,description:"Demo activity description",user:ie.name,created_at:x(new Date($.getTime()-v*36e5))}));return w(a)}if(l==="/dashboard/todos"&&t==="GET"){const r=Array.from({length:5}).map((a,f)=>({id:f+1,title:`Todo #${f+1}`,description:"Follow up with client",priority:["low","medium","high"][f%3],due_date:x(new Date($.getTime()+f*864e5)),completed:f%4===0,created_at:x(new Date($.getTime()-f*72e5))}));return w(r)}if(l==="/dashboard/notifications"&&t==="GET"){const r=Number((s==null?void 0:s.limit)??p.get("limit")??5),a=Array.from({length:r}).map((f,v)=>({id:v+1,title:`Notification ${v+1}`,message:"This is a demo notification",type:["info","success","warning","error"][v%4],read:v%3===0,created_at:x(new Date($.getTime()-v*54e5))}));return w(a)}if(l.startsWith("/dashboard/notifications/")&&l.endsWith("/read")&&t==="PUT")return w({});if(l==="/dashboard/quick-stats"&&t==="GET")return w({new_opportunities_today:3,pending_tasks:7,active_investors:I.filter(r=>r.status==="active").length,available_objects:S.filter(r=>r.status==="available").length});if(l==="/objects"&&t==="GET"){const r=Number((s==null?void 0:s.page)??p.get("page")??1),a=Number((s==null?void 0:s.per_page)??p.get("per_page")??10),f=Pt(S,s);return w(_e(f,r,a))}if(l.startsWith("/objects/")&&t==="GET"){const r=Number(l.split("/")[2]),a=S.find(f=>f.id===r);return w(a)}if(l==="/objects"&&t==="POST"){const r=S.length+1,a={...u,id:r,images:u.images??[],features:u.features??[],created_at:x($),updated_at:x($)};return S.push(a),w(a)}if(l.startsWith("/objects/")&&t==="PUT"){const r=Number(l.split("/")[2]),a=S.findIndex(f=>f.id===r);if(a>=0)return S[a]={...S[a],...u,updated_at:x(new Date)},w(S[a])}if(l.startsWith("/objects/")&&t==="DELETE")return w({});if(l==="/objects/batch-delete"&&t==="POST")return w({});if(l==="/objects/types"&&t==="GET")return w(ae);if(l==="/objects/statuses"&&t==="GET")return w(ue);if(l==="/objects/stats"&&t==="GET")return w({total:S.length,by_status:Object.fromEntries(ue.map(r=>[r,S.filter(a=>a.status===r).length])),by_type:Object.fromEntries(ae.map(r=>[r,S.filter(a=>a.type===r).length])),average_price:Math.round(S.reduce((r,a)=>r+a.price,0)/S.length),total_area:S.reduce((r,a)=>r+a.area,0)});if(l==="/objects/export"&&t==="GET")return w({});if(l.endsWith("/images")&&["POST","DELETE"].includes(t))return w({images:[]});if(l==="/opportunities"&&t==="GET"){const r=Number((s==null?void 0:s.page)??p.get("page")??1),a=Number((s==null?void 0:s.per_page)??p.get("per_page")??10);return w(_e(N,r,a))}if(l.startsWith("/opportunities/")&&t==="GET"){const r=Number(l.split("/")[2]),a=N.find(f=>f.id===r);return w(a)}if(l==="/opportunities"&&t==="POST"){const r=N.length+1,a={...u,id:r,created_at:x($),updated_at:x($)};return N.push(a),w(a)}if(l.startsWith("/opportunities/")&&t==="PUT")return w({...u});if(l.startsWith("/opportunities/")&&t==="DELETE")return w({});if(l==="/opportunities/batch-update-status"&&t==="POST")return w({});if(l==="/opportunities/stats"&&t==="GET")return w({total:N.length,by_status:{new:4,in_progress:9,completed:3,cancelled:2},by_priority:{low:6,medium:8,high:4},total_value:N.reduce((r,a)=>r+a.estimated_value,0),average_probability:Math.round(N.reduce((r,a)=>r+a.probability,0)/N.length),conversion_rate:27});if(l.endsWith("/timeline")&&t==="GET"){const r=Number(l.split("/")[2]),a=Array.from({length:5}).map((f,v)=>({id:v+1,action:["created","assigned","updated","follow_up","closed"][v],description:`Action ${v+1} for opportunity ${r}`,user:ie.name,created_at:x(new Date($.getTime()-v*36e5))}));return w(a)}if(l.endsWith("/notes")&&t==="POST")return w({});if(l==="/investors"&&t==="GET"){const r=Number((s==null?void 0:s.page)??p.get("page")??1),a=Number((s==null?void 0:s.per_page)??p.get("per_page")??10);return w(_e(I,r,a))}if(l.startsWith("/investors/")&&t==="GET"){const r=Number(l.split("/")[2]),a=I.find(f=>f.id===r);return w(a)}if(l==="/investors"&&t==="POST"){const r=I.length+1,a={...u,id:r,created_at:x($),updated_at:x($)};return I.push(a),w(a)}if(l.startsWith("/investors/")&&t==="PUT")return w({...u});if(l.startsWith("/investors/")&&t==="DELETE")return w({});if(l==="/investors/stats"&&t==="GET")return w({total:I.length,active:I.filter(r=>r.status==="active").length,total_capacity:I.reduce((r,a)=>r+a.investment_capacity,0),average_capacity:Math.round(I.reduce((r,a)=>r+a.investment_capacity,0)/I.length)});if(l.endsWith("/opportunities")&&t==="GET"){const r=Number(l.split("/")[2]),a=N.filter(f=>f.investor_id===r);return w(a)}if(l==="/files"&&t==="GET"){const r=Number((s==null?void 0:s.page)??p.get("page")??1),a=Number((s==null?void 0:s.per_page)??p.get("per_page")??10);return w(_e(G,r,a))}if(l.startsWith("/files/")&&t==="GET"){const r=Number(l.split("/")[2]),a=G.find(f=>f.id===r);return w(a)}if(l==="/files"&&t==="POST"){const r=G.length+1,a={id:r,name:u!=null&&u.get?((g=u.get("file"))==null?void 0:g.name)||`file_${r}.bin`:`file_${r}.bin`,original_name:`Original ${r}`,path:`/uploads/file_${r}.bin`,size:1024*r,mime_type:"application/octet-stream",category:"contracts",related_type:"object",related_id:r,uploaded_by:1,created_at:x(new Date)};return G.push(a),w(a)}return l==="/files/batch-upload"&&t==="POST"?w(G.slice(0,3)):l.startsWith("/files/")&&["PUT","DELETE"].includes(t)?w({}):l==="/files/categories"&&t==="GET"?w(yt):l.startsWith("/files/categories")&&["POST","PUT","DELETE"].includes(t)?w({...u||{}}):w(l==="/files/stats"&&t==="GET"?{total_files:G.length,total_size:G.reduce((r,a)=>r+a.size,0),by_category:G.reduce((r,a)=>(r[a.category]=(r[a.category]||0)+1,r),{}),by_type:{pdf:12,image:6,other:2},recent_uploads:G.slice(0,5)}:l==="/files/cleanup"&&t==="POST"?{deleted_count:2,freed_space:345678}:{})}function Pt(t,e){if(!e)return t;let s=t;return e.type&&(s=s.filter(u=>u.type===e.type)),e.status&&(s=s.filter(u=>u.status===e.status)),e.min_price&&(s=s.filter(u=>u.price>=e.min_price)),e.max_price&&(s=s.filter(u=>u.price<=e.max_price)),e.min_area&&(s=s.filter(u=>u.area>=e.min_area)),e.max_area&&(s=s.filter(u=>u.area<=e.max_area)),e.location&&(s=s.filter(u=>u.address.includes(e.location))),e.search&&(s=s.filter(u=>u.name.includes(e.search)||u.address.includes(e.search))),s}const{error:Tt}=se(),Z=ut.create({baseURL:"https://api.changtuo.com/api",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});Z.interceptors.request.use(t=>{const e=localStorage.getItem("auth_token");return e&&(t.headers||(t.headers={}),t.headers.Authorization=`Bearer ${e}`),t.method==="get"&&(t.params={...t.params,_t:Date.now()}),t},t=>(console.error("Request error:",t),Promise.reject(t)));Z.interceptors.response.use(t=>{var s,u,l;const{data:e}=t;if(e.success===!1){const _=e.message||"請求失敗";return Tt(_,"操作失敗"),ke(new Error(_),((s=t.config)==null?void 0:s.url)||"",((l=(u=t.config)==null?void 0:u.method)==null?void 0:l.toUpperCase())||"UNKNOWN"),Promise.reject(new Error(_))}return t},t=>{var s,u,l;console.error("API Error:",t),ke(t,((s=t.config)==null?void 0:s.url)||"",((l=(u=t.config)==null?void 0:u.method)==null?void 0:l.toUpperCase())||"UNKNOWN");const{response:e}=t;if(e){const{status:_,data:p}=e,g={message:(p==null?void 0:p.message)||"請求失敗",status:_,errors:p==null?void 0:p.errors};switch(_){case 401:localStorage.removeItem("auth_token"),localStorage.removeItem("user_info"),t("登入已過期，請重新登入","認證失敗"),window.location.href="/login";break;case 403:t("沒有權限執行此操作","權限不足");break;case 404:t("請求的資源不存在","資源未找到");break;case 422:if(g.errors){const r=Object.values(g.errors)[0];t(Array.isArray(r)?r[0]:r,"驗證失敗")}else t(g.message,"驗證失敗");break;case 500:t("服務器內部錯誤","系統錯誤");break;default:t(g.message,"請求失敗")}return Promise.reject(g)}else t.code==="ECONNABORTED"?t("請求超時，請稍後重試","網路超時"):t("網絡錯誤，請檢查網絡連接","網路錯誤");return Promise.reject(t)});const D={get(t,e){return Y?ee.get(t,e):Z.get(t,{params:e}).then(s=>s.data)},post(t,e){return Y?ee.post(t,e):Z.post(t,e).then(s=>s.data)},put(t,e){return Y?ee.put(t,e):Z.put(t,e).then(s=>s.data)},patch(t,e){return Y?ee.patch(t,e):Z.patch(t,e).then(s=>s.data)},delete(t,e){return Y?ee.delete(t,e):Z.delete(t,e?{data:e}:void 0).then(s=>s.data)},upload(t,e,s){return Y?ee.upload(t,e):Z.post(t,e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s?u=>{const l=u.total||0,_=u.loaded||0,p=l>0?Math.round(_/l*100):0;s(p)}:void 0}).then(u=>u.data)}},W={login(t){return D.post("/auth/login",t)},register(t){return D.post("/auth/register",t)},logout(){return D.post("/auth/logout")},me(){return D.get("/auth/me")},refresh(){return D.post("/auth/refresh")},forgotPassword(t){return D.post("/auth/forgot-password",{email:t})},resetPassword(t){return D.post("/auth/reset-password",t)},changePassword(t){return D.post("/auth/change-password",t)},updateProfile(t){return D.put("/auth/profile",t)},uploadAvatar(t){const e=new FormData;return e.append("avatar",t),D.upload("/auth/avatar",e)},verifyEmail(t){return D.post("/auth/verify-email",{token:t})},resendVerification(){return D.post("/auth/resend-verification")}},ge=it("auth",()=>{const t=E(null),e=E(localStorage.getItem("auth_token")),s=E(!1),u=J(()=>!!e.value&&!!t.value),l=J(()=>{var o;return((o=t.value)==null?void 0:o.permissions)||[]}),_=J(()=>{var o;return((o=t.value)==null?void 0:o.role)||""}),p=o=>l.value.includes(o),g=o=>o.some(m=>p(m)),r=o=>o.every(m=>p(m)),a=async o=>{try{s.value=!0;const m=await W.login(o);if(m.success&&m.data){const{user:R,token:O}=m.data;return t.value=R,e.value=O,localStorage.setItem("auth_token",O),localStorage.setItem("user_info",JSON.stringify(R)),{success:!0}}return{success:!1,message:m.message||"登入失敗"}}catch(m){return{success:!1,message:m.message||"登入失敗，請稍後重試"}}finally{s.value=!1}},f=async o=>{try{s.value=!0;const m=await W.register(o);return m.success&&m.data?{success:!0}:{success:!1,message:m.message||"註冊失敗"}}catch(m){return{success:!1,message:m.message||"註冊失敗，請稍後重試"}}finally{s.value=!1}},v=async o=>{try{s.value=!0;const m=await W.forgotPassword(o);return m.success?{success:!0}:{success:!1,message:m.message||"發送失敗"}}catch(m){return{success:!1,message:m.message||"發送失敗，請稍後重試"}}finally{s.value=!1}},k=async o=>{try{s.value=!0;const m={...o,password_confirmation:o.password_confirmation??o.password},R=await W.resetPassword(m);return R.success?{success:!0}:{success:!1,message:R.message||"重置失敗"}}catch(m){return{success:!1,message:m.message||"重置失敗，請稍後重試"}}finally{s.value=!1}},y=async()=>{try{await W.logout()}catch(o){console.error("Logout API error:",o)}finally{t.value=null,e.value=null,localStorage.removeItem("auth_token"),localStorage.removeItem("user_info")}},j=async()=>{try{if(!e.value)return!1;const o=await W.me();return o.success&&o.data?(t.value=o.data,localStorage.setItem("user_info",JSON.stringify(o.data)),!0):!1}catch(o){return console.error("Fetch user error:",o),await y(),!1}};return{user:t,token:e,loading:s,isAuthenticated:u,userPermissions:l,userRole:_,hasPermission:p,hasAnyPermission:g,hasAllPermissions:r,login:a,logout:y,fetchUser:j,refreshToken:async()=>{try{const o=await W.refresh();return o.success&&o.data?(e.value=o.data.token,localStorage.setItem("auth_token",o.data.token),!0):!1}catch(o){return console.error("Refresh token error:",o),await y(),!1}},updateProfile:async o=>{try{s.value=!0;const m=await W.updateProfile(o);return m.success&&m.data?(t.value=m.data,localStorage.setItem("user_info",JSON.stringify(m.data)),{success:!0}):{success:!1,message:m.message||"更新失敗"}}catch(m){return{success:!1,message:m.message||"更新失敗，請稍後重試"}}finally{s.value=!1}},initAuth:async()=>{const o=localStorage.getItem("auth_token"),m=localStorage.getItem("user_info");if(o&&m)try{e.value=o,t.value=JSON.parse(m),await j()||await y()}catch(R){console.error("Init auth error:",R),await y()}},checkAuth:()=>{const o=localStorage.getItem("auth_token"),m=localStorage.getItem("user_info");if(o&&m)try{return e.value=o,t.value=JSON.parse(m),!0}catch(R){return console.error("Check auth error:",R),!1}return!1},register:f,forgotPassword:v,resetPassword:k}}),kt={class:"login-container"},Et={class:"login-card"},St={class:"login-options"},xt={class:"register-link"},Vt=ne({__name:"LoginPage",setup(t){const e=be(),s=Ae(),u=ge(),l=E(),_=E(!1),p=H({email:"",password:"",remember:!1}),g={email:[{required:!0,message:"請輸入電子郵件",trigger:"blur"},{type:"email",message:"請輸入正確的電子郵件格式",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼長度至少6個字符",trigger:"blur"}]},r=async()=>{if(l.value)try{if(!await l.value.validate())return;_.value=!0;const f={email:p.email,password:p.password};await u.login(f),C.success("登入成功！");const v=s.query.redirect;e.push(v||"/dashboard")}catch(a){console.error("Login error:",a),C.error(a.message||"登入失敗，請檢查您的帳戶資訊")}finally{_.value=!1}};return we(()=>{u.isAuthenticated&&e.push("/dashboard");const a=localStorage.getItem("rememberedEmail");a&&(p.email=a,p.remember=!0)}),(a,f)=>{const v=ce,k=de,y=Se,j=he("router-link"),U=pe,P=fe;return A(),z("div",kt,[c("div",Et,[f[7]||(f[7]=c("div",{class:"login-header"},[c("h1",{class:"login-title"},"長拓不動產管理系統"),c("p",{class:"login-subtitle"},"歡迎回來，請登入您的帳戶")],-1)),n(P,{ref_key:"loginFormRef",ref:l,model:p,rules:g,class:"login-form",onSubmit:ye(r,["prevent"])},{default:d(()=>[n(k,{prop:"email"},{default:d(()=>[n(v,{modelValue:p.email,"onUpdate:modelValue":f[0]||(f[0]=i=>p.email=i),type:"email","prefix-icon":V(Ee),placeholder:"請輸入電子郵件",size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),n(k,{prop:"password"},{default:d(()=>[n(v,{modelValue:p.password,"onUpdate:modelValue":f[1]||(f[1]=i=>p.password=i),"prefix-icon":V(re),type:"password",placeholder:"請輸入密碼",size:"large","show-password":"",clearable:"",onKeyup:nt(r,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),n(k,null,{default:d(()=>[c("div",St,[n(y,{modelValue:p.remember,"onUpdate:modelValue":f[2]||(f[2]=i=>p.remember=i)},{default:d(()=>[...f[3]||(f[3]=[T("記住我",-1)])]),_:1},8,["modelValue"]),n(j,{to:"/forgot-password",class:"forgot-link"},{default:d(()=>[...f[4]||(f[4]=[T(" 忘記密碼？ ",-1)])]),_:1})])]),_:1}),n(k,null,{default:d(()=>[n(U,{type:"primary",size:"large",loading:_.value,class:"login-button","html-type":"submit",onClick:r},{default:d(()=>[T(L(_.value?"登入中...":"登入"),1)]),_:1},8,["loading"])]),_:1}),n(k,null,{default:d(()=>[c("div",xt,[f[6]||(f[6]=T(" 還沒有帳戶？ ",-1)),n(j,{to:"/register"},{default:d(()=>[...f[5]||(f[5]=[T("立即註冊",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),f[8]||(f[8]=c("div",{class:"background-decoration"},[c("div",{class:"decoration-circle circle-1"}),c("div",{class:"decoration-circle circle-2"}),c("div",{class:"decoration-circle circle-3"})],-1))])}}}),$t=le(Vt,[["__scopeId","data-v-812b441d"]]),vs=Object.freeze(Object.defineProperty({__proto__:null,default:$t},Symbol.toStringTag,{value:"Module"})),At={class:"register-container"},Rt={class:"register-card"},jt={class:"register-footer"},It=ne({__name:"RegisterPage",setup(t){const e=be(),s=ge(),u=E(),l=E(!1),_=E(!1),p=E(!1),g=H({name:"",email:"",phone:"",password:"",password_confirmation:"",confirmPassword:"",company:"",agreeTerms:!1}),f={name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{min:2,max:20,message:"姓名長度應在2-20個字符之間",trigger:"blur"}],email:[{required:!0,message:"請輸入郵箱地址",trigger:"blur"},{type:"email",message:"請輸入正確的郵箱格式",trigger:"blur"}],phone:[{required:!0,message:"請輸入手機號碼",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"請輸入正確的手機號碼",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,max:20,message:"密碼長度應在6-20個字符之間",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密碼必須包含大小寫字母和數字",trigger:"blur"}],confirmPassword:[{required:!0,validator:(P,i,h)=>{i===""?h(new Error("請確認密碼")):i!==g.password?h(new Error("兩次輸入的密碼不一致")):h()},trigger:"blur"}],company:[{max:50,message:"公司名稱不能超過50個字符",trigger:"blur"}],agreeTerms:[{required:!0,validator:(P,i,h)=>{i?h():h(new Error("請同意服務條款和隱私政策"))},trigger:"change"}]},v=async()=>{if(u.value)try{await u.value.validate(),l.value=!0;const P={name:g.name,email:g.email,phone:g.phone,password:g.password,password_confirmation:g.confirmPassword,company:g.company||void 0};await s.register(P),C.success("註冊成功！請查收郵箱驗證郵件"),e.push("/auth/login")}catch(P){console.error("註冊失敗:",P),C.error(P.message||"註冊失敗，請稍後重試")}finally{l.value=!1}},k=()=>{_.value=!0},y=()=>{p.value=!0},j=P=>{P()},U=P=>{P()};return(P,i)=>{const h=ce,o=de,m=Ge,R=Se,O=ve,F=pe,M=fe,K=he("router-link"),q=Me;return A(),z("div",At,[c("div",Rt,[i[17]||(i[17]=c("div",{class:"register-header"},[c("h1",null,"創建帳戶"),c("p",null,"填寫以下信息來創建您的帳戶")],-1)),n(M,{ref_key:"registerFormRef",ref:u,model:g,rules:f,class:"register-form",onSubmit:ye(v,["prevent"])},{default:d(()=>[n(o,{prop:"name"},{default:d(()=>[n(h,{modelValue:g.name,"onUpdate:modelValue":i[0]||(i[0]=b=>g.name=b),name:"name",placeholder:"請輸入姓名",size:"large","prefix-icon":V(Ee)},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"email"},{default:d(()=>[n(h,{modelValue:g.email,"onUpdate:modelValue":i[1]||(i[1]=b=>g.email=b),name:"email",type:"email",placeholder:"請輸入郵箱地址",size:"large","prefix-icon":V(xe)},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"phone"},{default:d(()=>[n(h,{modelValue:g.phone,"onUpdate:modelValue":i[2]||(i[2]=b=>g.phone=b),name:"phone",placeholder:"請輸入手機號碼",size:"large","prefix-icon":V(Fe)},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"password"},{default:d(()=>[n(h,{modelValue:g.password,"onUpdate:modelValue":i[3]||(i[3]=b=>g.password=b),name:"password",type:"password",placeholder:"請輸入密碼",size:"large","prefix-icon":V(re),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"confirmPassword"},{default:d(()=>[n(h,{modelValue:g.confirmPassword,"onUpdate:modelValue":i[4]||(i[4]=b=>g.confirmPassword=b),name:"confirmPassword",type:"password",placeholder:"請確認密碼",size:"large","prefix-icon":V(re),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"company"},{default:d(()=>[n(h,{modelValue:g.company,"onUpdate:modelValue":i[5]||(i[5]=b=>g.company=b),placeholder:"請輸入公司名稱（可選）",size:"large","prefix-icon":V(qe)},null,8,["modelValue","prefix-icon"])]),_:1}),n(o,{prop:"agreeTerms",class:"terms-item"},{default:d(()=>[n(R,{modelValue:g.agreeTerms,"onUpdate:modelValue":i[6]||(i[6]=b=>g.agreeTerms=b)},{default:d(()=>[i[13]||(i[13]=T(" 我已閱讀並同意 ",-1)),n(m,{type:"primary",onClick:k},{default:d(()=>[...i[11]||(i[11]=[T("《服務條款》",-1)])]),_:1}),i[14]||(i[14]=T(" 和 ",-1)),n(m,{type:"primary",onClick:y},{default:d(()=>[...i[12]||(i[12]=[T("《隱私政策》",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(o,null,{default:d(()=>[n(F,{type:"primary",size:"large",class:"register-button",loading:l.value,onClick:v},{default:d(()=>[l.value?B("",!0):(A(),oe(O,{key:0},{default:d(()=>[n(V(Le))]),_:1})),T(" "+L(l.value?"註冊中...":"註冊"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",jt,[c("p",null,[i[16]||(i[16]=T(" 已有帳戶？ ",-1)),n(K,{to:"/auth/login",class:"login-link"},{default:d(()=>[...i[15]||(i[15]=[T(" 立即登入 ",-1)])]),_:1})])])]),n(q,{modelValue:_.value,"onUpdate:modelValue":i[8]||(i[8]=b=>_.value=b),title:"服務條款",width:"80%","before-close":j},{footer:d(()=>[n(F,{onClick:i[7]||(i[7]=b=>_.value=!1)},{default:d(()=>[...i[18]||(i[18]=[T("關閉",-1)])]),_:1})]),default:d(()=>[i[19]||(i[19]=c("div",{class:"terms-content"},[c("h3",null,"1. 服務說明"),c("p",null,"本平台為房地產投資管理系統，為用戶提供物業管理、投資機會分析等服務。"),c("h3",null,"2. 用戶責任"),c("p",null,"用戶應確保提供的信息真實、準確，並承擔因信息不實造成的後果。"),c("h3",null,"3. 隱私保護"),c("p",null,"我們承諾保護用戶隱私，不會未經授權披露用戶個人信息。"),c("h3",null,"4. 服務變更"),c("p",null,"我們保留隨時修改或終止服務的權利，並會提前通知用戶。"),c("h3",null,"5. 免責聲明"),c("p",null,"平台提供的信息僅供參考，投資決策應基於用戶自己的判斷。")],-1))]),_:1},8,["modelValue"]),n(q,{modelValue:p.value,"onUpdate:modelValue":i[10]||(i[10]=b=>p.value=b),title:"隱私政策",width:"80%","before-close":U},{footer:d(()=>[n(F,{onClick:i[9]||(i[9]=b=>p.value=!1)},{default:d(()=>[...i[20]||(i[20]=[T("關閉",-1)])]),_:1})]),default:d(()=>[i[21]||(i[21]=c("div",{class:"privacy-content"},[c("h3",null,"1. 信息收集"),c("p",null,"我們收集您主動提供的個人信息，包括姓名、郵箱、電話等。"),c("h3",null,"2. 信息使用"),c("p",null,"收集的信息用於提供服務、改善用戶體驗、發送重要通知等。"),c("h3",null,"3. 信息保護"),c("p",null,"我們採用行業標準的安全措施保護您的個人信息。"),c("h3",null,"4. 信息共享"),c("p",null,"除法律要求外，我們不會與第三方共享您的個人信息。"),c("h3",null,"5. Cookie使用"),c("p",null,"我們使用Cookie來改善網站功能和用戶體驗。")],-1))]),_:1},8,["modelValue"])])}}}),Ct=le(It,[["__scopeId","data-v-712cfd35"]]),ws=Object.freeze(Object.defineProperty({__proto__:null,default:Ct},Symbol.toStringTag,{value:"Module"})),Ot={class:"forgot-password-container"},Dt={class:"forgot-password-card"},zt={class:"forgot-password-header"},Ut={class:"forgot-password-footer"},Nt={key:0,class:"success-card"},Ft={class:"success-content"},qt={class:"success-actions"},Gt=ne({__name:"ForgotPasswordPage",setup(t){const e=be(),s=ge(),u=E(),l=E(!1),_=E(!1),p=E(!1),g=H({email:""}),r={email:[{required:!0,message:"請輸入郵箱地址",trigger:"blur"},{type:"email",message:"請輸入正確的郵箱格式",trigger:"blur"}]},a=async()=>{if(u.value)try{await u.value.validate(),l.value=!0,await s.forgotPassword(g.email),p.value=!0,C.success("重置密碼郵件已發送")}catch(k){console.error("發送重置郵件失敗:",k),C.error(k.message||"發送失敗，請稍後重試")}finally{l.value=!1}},f=async()=>{try{_.value=!0,await s.forgotPassword(g.email),C.success("重置密碼郵件已重新發送")}catch(k){console.error("重新發送郵件失敗:",k),C.error(k.message||"重新發送失敗，請稍後重試")}finally{_.value=!1}},v=()=>{e.push("/auth/login")};return(k,y)=>{const j=ve,U=ce,P=de,i=pe,h=fe,o=he("router-link");return A(),z("div",Ot,[c("div",Dt,[c("div",zt,[n(j,{class:"header-icon"},{default:d(()=>[n(V(We))]),_:1}),y[1]||(y[1]=c("h1",null,"忘記密碼",-1)),y[2]||(y[2]=c("p",null,"請輸入您的郵箱地址，我們將發送重置密碼的鏈接給您",-1))]),n(h,{ref_key:"forgotPasswordFormRef",ref:u,model:g,rules:r,class:"forgot-password-form",onSubmit:ye(a,["prevent"])},{default:d(()=>[n(P,{prop:"email"},{default:d(()=>[n(U,{modelValue:g.email,"onUpdate:modelValue":y[0]||(y[0]=m=>g.email=m),type:"email",placeholder:"請輸入您的郵箱地址",size:"large","prefix-icon":V(xe)},null,8,["modelValue","prefix-icon"])]),_:1}),n(P,null,{default:d(()=>[n(i,{type:"primary",size:"large",class:"submit-button",loading:l.value,onClick:a},{default:d(()=>[l.value?B("",!0):(A(),oe(j,{key:0},{default:d(()=>[n(V(Ze))]),_:1})),T(" "+L(l.value?"發送中...":"發送重置鏈接"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",Ut,[c("p",null,[y[4]||(y[4]=T(" 記起密碼了？ ",-1)),n(o,{to:"/auth/login",class:"login-link"},{default:d(()=>[...y[3]||(y[3]=[T(" 返回登錄 ",-1)])]),_:1})]),c("p",null,[y[6]||(y[6]=T(" 還沒有帳戶？ ",-1)),n(o,{to:"/auth/register",class:"register-link"},{default:d(()=>[...y[5]||(y[5]=[T(" 立即註冊 ",-1)])]),_:1})])])]),p.value?(A(),z("div",Nt,[c("div",Ft,[n(j,{class:"success-icon"},{default:d(()=>[n(V(Ve))]),_:1}),y[10]||(y[10]=c("h2",null,"郵件已發送",-1)),c("p",null,[y[7]||(y[7]=T("我們已向 ",-1)),c("strong",null,L(g.email),1),y[8]||(y[8]=T(" 發送了重置密碼的鏈接",-1))]),y[11]||(y[11]=c("p",{class:"tips"},"請檢查您的郵箱（包括垃圾郵件文件夾），並點擊鏈接重置密碼",-1)),c("div",qt,[n(i,{type:"primary",onClick:v},{default:d(()=>[...y[9]||(y[9]=[T(" 返回登錄 ",-1)])]),_:1}),n(i,{onClick:f,loading:_.value},{default:d(()=>[T(L(_.value?"重新發送中...":"重新發送"),1)]),_:1},8,["loading"])])])])):B("",!0)])}}}),Lt=le(Gt,[["__scopeId","data-v-5e23fef0"]]),hs=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"})),Mt={class:"reset-password-container"},Wt={class:"reset-password-card"},Zt={class:"reset-password-header"},Bt={class:"password-strength"},Jt={class:"strength-bar"},Ht={class:"reset-password-footer"},Kt={key:0,class:"success-card"},Qt={class:"success-content"},Yt={class:"success-actions"},Xt={key:1,class:"error-card"},es={class:"error-content"},ts={class:"error-actions"},ss=ne({__name:"ResetPasswordPage",setup(t){const e=be(),s=Ae(),u=ge(),l=E(),_=E(!1),p=E(!1),g=E(!1),r=H({password:"",confirmPassword:"",token:""}),f={password:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{min:6,max:20,message:"密碼長度應在6-20個字符之間",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密碼必須包含大小寫字母和數字",trigger:"blur"}],confirmPassword:[{required:!0,validator:(h,o,m)=>{o===""?m(new Error("請確認密碼")):o!==r.password?m(new Error("兩次輸入的密碼不一致")):m()},trigger:"blur"}]},v=J(()=>{const h=r.password;if(!h)return 0;let o=0;return h.length>=6&&(o+=1),h.length>=8&&(o+=1),/[a-z]/.test(h)&&(o+=1),/[A-Z]/.test(h)&&(o+=1),/\d/.test(h)&&(o+=1),/[!@#$%^&*(),.?":{}|<>]/.test(h)&&(o+=1),Math.min(o,4)}),k=J(()=>`${v.value/4*100}%`),y=J(()=>{switch(v.value){case 0:case 1:return"weak";case 2:return"fair";case 3:return"good";case 4:return"strong";default:return"weak"}}),j=J(()=>{switch(v.value){case 0:case 1:return"弱";case 2:return"一般";case 3:return"良好";case 4:return"強";default:return"弱"}}),U=async()=>{var h,o;if(l.value)try{await l.value.validate(),_.value=!0,await u.resetPassword({token:r.token,password:r.password}),p.value=!0,C.success("密碼重置成功")}catch(m){console.error("重置密碼失敗:",m),(h=m.message)!=null&&h.includes("token")||(o=m.message)!=null&&o.includes("expired")?g.value=!0:C.error(m.message||"重置失敗，請稍後重試")}finally{_.value=!1}},P=()=>{e.push("/auth/login")},i=()=>{e.push("/auth/forgot-password")};return we(()=>{const h=s.query.token;if(!h){g.value=!0;return}r.token=h}),(h,o)=>{const m=ve,R=ce,O=de,F=pe,M=fe,K=he("router-link");return A(),z("div",Mt,[c("div",Wt,[c("div",Zt,[n(m,{class:"header-icon"},{default:d(()=>[n(V(re))]),_:1}),o[2]||(o[2]=c("h1",null,"重置密碼",-1)),o[3]||(o[3]=c("p",null,"請輸入您的新密碼",-1))]),n(M,{ref_key:"resetPasswordFormRef",ref:l,model:r,rules:f,class:"reset-password-form",onSubmit:ye(U,["prevent"])},{default:d(()=>[n(O,{prop:"password"},{default:d(()=>[n(R,{modelValue:r.password,"onUpdate:modelValue":o[0]||(o[0]=q=>r.password=q),type:"password",placeholder:"請輸入新密碼",size:"large","prefix-icon":V(re),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),n(O,{prop:"confirmPassword"},{default:d(()=>[n(R,{modelValue:r.confirmPassword,"onUpdate:modelValue":o[1]||(o[1]=q=>r.confirmPassword=q),type:"password",placeholder:"請確認新密碼",size:"large","prefix-icon":V(re),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),c("div",Bt,[o[4]||(o[4]=c("div",{class:"strength-label"},"密碼強度：",-1)),c("div",Jt,[c("div",{class:Pe(["strength-fill",y.value]),style:lt({width:k.value})},null,6)]),c("div",{class:Pe(["strength-text",y.value])},L(j.value),3)]),n(O,null,{default:d(()=>[n(F,{type:"primary",size:"large",class:"submit-button",loading:_.value,onClick:U},{default:d(()=>[_.value?B("",!0):(A(),oe(m,{key:0},{default:d(()=>[n(V(Be))]),_:1})),T(" "+L(_.value?"重置中...":"重置密碼"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",Ht,[c("p",null,[o[6]||(o[6]=T(" 記起密碼了？ ",-1)),n(K,{to:"/auth/login",class:"login-link"},{default:d(()=>[...o[5]||(o[5]=[T(" 返回登錄 ",-1)])]),_:1})])])]),p.value?(A(),z("div",Kt,[c("div",Qt,[n(m,{class:"success-icon"},{default:d(()=>[n(V(Ve))]),_:1}),o[8]||(o[8]=c("h2",null,"密碼重置成功",-1)),o[9]||(o[9]=c("p",null,"您的密碼已成功重置，請使用新密碼登錄",-1)),c("div",Yt,[n(F,{type:"primary",onClick:P},{default:d(()=>[...o[7]||(o[7]=[T(" 立即登錄 ",-1)])]),_:1})])])])):B("",!0),g.value?(A(),z("div",Xt,[c("div",es,[n(m,{class:"error-icon"},{default:d(()=>[n(V(Je))]),_:1}),o[12]||(o[12]=c("h2",null,"鏈接已失效",-1)),o[13]||(o[13]=c("p",null,"重置密碼鏈接已過期或無效，請重新申請",-1)),c("div",ts,[n(F,{type:"primary",onClick:i},{default:d(()=>[...o[10]||(o[10]=[T(" 重新申請 ",-1)])]),_:1}),n(F,{onClick:P},{default:d(()=>[...o[11]||(o[11]=[T(" 返回登錄 ",-1)])]),_:1})])])])):B("",!0)])}}}),rs=le(ss,[["__scopeId","data-v-98adf299"]]),ys=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"}));function Re(t){if(!t||typeof t!="string")return!1;const e=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,s=t.trim();if(!e.test(s)||s.includes(".."))return!1;const u=s.split("@");if(u.length!==2)return!1;const[l,_]=u;return!(!l||l.length===0||l.length>64||!_||_.length===0||_.length>253||!_.includes("."))}function os(t){if(!t||typeof t!="string")return!1;const e=t.replace(/[^\d+]/g,"");return/^\+?\d{10,15}$/.test(e)}function as(t){return!t||typeof t!="string"?!1:/^\d+(\.\d{1,2})?$/.test(t.trim())&&parseFloat(t)>0}function ns(t){return!t||typeof t!="string"?!1:/^\d+(\.\d+)?$/.test(t.trim())&&parseFloat(t)>0}function bs(t){return!t||typeof t!="string"?!1:/^\d{6}$/.test(t.trim())}function Ps(t){if(!t||typeof t!="string")return!1;const e=parseFloat(t);return!isNaN(e)&&e>=-180&&e<=180}function Ts(t){if(!t||typeof t!="string")return!1;const e=parseFloat(t);return!isNaN(e)&&e>=-90&&e<=90}const ks={email:{validator:Re,message:"請輸入正確的郵箱地址"},phone:{validator:os,message:"請輸入正確的手機號碼"},price:{validator:as,message:"請輸入正確的價格"},area:{validator:ns,message:"請輸入正確的面積"}},ls={class:"profile-page"},is=ne({__name:"ProfilePage",setup(t){ge();const e=E(),s=E(),u=E(!1),l=E(!1),_=E(!1),p=H({name:"",email:"",phone:"",department:"",bio:""}),g=H({name:"",email:"",phone:"",department:"",bio:""}),r=H({currentPassword:"",newPassword:"",confirmPassword:""}),a={name:[{required:!0,message:"請輸入姓名",trigger:"blur"},{min:2,max:50,message:"姓名長度應在 2 到 50 個字符之間",trigger:"blur"}],email:[{required:!0,message:"請輸入電子郵件",trigger:"blur"},{validator:(P,i,h)=>{Re(i)?h():h(new Error("請輸入有效的電子郵件地址"))},trigger:"blur"}],phone:[{pattern:/^[0-9-+\s()]*$/,message:"請輸入有效的電話號碼",trigger:"blur"}]},f={currentPassword:[{required:!0,message:"請輸入當前密碼",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{min:8,message:"密碼長度至少為 8 個字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,message:"密碼必須包含大小寫字母和數字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請確認新密碼",trigger:"blur"},{validator:(P,i,h)=>{i!==r.newPassword?h(new Error("兩次輸入的密碼不一致")):h()},trigger:"blur"}]},v=async()=>{try{const P={name:"張三",email:"zhang.san@example.com",phone:"0912-345-678",department:"tech",bio:"資深前端開發工程師，專精於 Vue.js 和 TypeScript 開發。"};Object.assign(p,P),Object.assign(g,P)}catch{C.error("載入用戶資料失敗")}},k=()=>{u.value=!0},y=()=>{Object.assign(p,g),u.value=!1},j=async()=>{if(e.value)try{await e.value.validate(),l.value=!0,await new Promise(P=>setTimeout(P,1e3)),Object.assign(g,p),u.value=!1,C.success("個人資料更新成功")}catch{C.error("個人資料更新失敗")}finally{l.value=!1}},U=async()=>{if(s.value)try{await s.value.validate(),_.value=!0,await new Promise(P=>setTimeout(P,1e3)),Object.assign(r,{currentPassword:"",newPassword:"",confirmPassword:""}),C.success("密碼修改成功")}catch{C.error("密碼修改失敗")}finally{_.value=!1}};return we(()=>{v()}),(P,i)=>{const h=ce,o=de,m=Ke,R=He,O=Ye,F=Qe,M=pe,K=fe,q=Xe;return A(),z("div",ls,[n(q,{class:"profile-card"},{header:d(()=>[...i[8]||(i[8]=[c("div",{class:"card-header"},[c("h2",null,"個人資料")],-1)])]),default:d(()=>[n(K,{ref_key:"profileFormRef",ref:e,model:p,rules:a,"label-width":"120px",class:"profile-form"},{default:d(()=>[n(R,{gutter:20},{default:d(()=>[n(m,{span:12},{default:d(()=>[n(o,{label:"姓名",prop:"name"},{default:d(()=>[n(h,{modelValue:p.name,"onUpdate:modelValue":i[0]||(i[0]=b=>p.name=b),placeholder:"請輸入姓名",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),n(m,{span:12},{default:d(()=>[n(o,{label:"電子郵件",prop:"email"},{default:d(()=>[n(h,{modelValue:p.email,"onUpdate:modelValue":i[1]||(i[1]=b=>p.email=b),placeholder:"請輸入電子郵件",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),n(R,{gutter:20},{default:d(()=>[n(m,{span:12},{default:d(()=>[n(o,{label:"電話號碼",prop:"phone"},{default:d(()=>[n(h,{modelValue:p.phone,"onUpdate:modelValue":i[2]||(i[2]=b=>p.phone=b),placeholder:"請輸入電話號碼",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),n(m,{span:12},{default:d(()=>[n(o,{label:"部門",prop:"department"},{default:d(()=>[n(F,{modelValue:p.department,"onUpdate:modelValue":i[3]||(i[3]=b=>p.department=b),placeholder:"請選擇部門",disabled:!u.value,style:{width:"100%"}},{default:d(()=>[n(O,{label:"業務部",value:"sales"}),n(O,{label:"技術部",value:"tech"}),n(O,{label:"行政部",value:"admin"}),n(O,{label:"財務部",value:"finance"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),n(o,{label:"個人簡介",prop:"bio"},{default:d(()=>[n(h,{modelValue:p.bio,"onUpdate:modelValue":i[4]||(i[4]=b=>p.bio=b),type:"textarea",rows:4,placeholder:"請輸入個人簡介",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1}),n(o,null,{default:d(()=>[u.value?(A(),z($e,{key:1},[n(M,{type:"primary",loading:l.value,onClick:j},{default:d(()=>[...i[10]||(i[10]=[T(" 保存 ",-1)])]),_:1},8,["loading"]),n(M,{onClick:y},{default:d(()=>[...i[11]||(i[11]=[T(" 取消 ",-1)])]),_:1})],64)):(A(),oe(M,{key:0,type:"primary",onClick:k},{default:d(()=>[...i[9]||(i[9]=[T(" 編輯資料 ",-1)])]),_:1}))]),_:1})]),_:1},8,["model"])]),_:1}),n(q,{class:"password-card",style:{"margin-top":"20px"}},{header:d(()=>[...i[12]||(i[12]=[c("div",{class:"card-header"},[c("h3",null,"修改密碼")],-1)])]),default:d(()=>[n(K,{ref_key:"passwordFormRef",ref:s,model:r,rules:f,"label-width":"120px",class:"password-form"},{default:d(()=>[n(o,{label:"當前密碼",prop:"currentPassword"},{default:d(()=>[n(h,{modelValue:r.currentPassword,"onUpdate:modelValue":i[5]||(i[5]=b=>r.currentPassword=b),type:"password",placeholder:"請輸入當前密碼","show-password":""},null,8,["modelValue"])]),_:1}),n(o,{label:"新密碼",prop:"newPassword"},{default:d(()=>[n(h,{modelValue:r.newPassword,"onUpdate:modelValue":i[6]||(i[6]=b=>r.newPassword=b),type:"password",placeholder:"請輸入新密碼","show-password":""},null,8,["modelValue"])]),_:1}),n(o,{label:"確認密碼",prop:"confirmPassword"},{default:d(()=>[n(h,{modelValue:r.confirmPassword,"onUpdate:modelValue":i[7]||(i[7]=b=>r.confirmPassword=b),type:"password",placeholder:"請再次輸入新密碼","show-password":""},null,8,["modelValue"])]),_:1}),n(o,null,{default:d(()=>[n(M,{type:"primary",loading:_.value,onClick:U},{default:d(()=>[...i[13]||(i[13]=[T(" 修改密碼 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),us=le(is,[["__scopeId","data-v-71571962"]]),Es=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"}));export{hs as F,vs as L,Es as P,ws as R,se as a,Ts as b,ks as c,Ps as d,Re as e,ht as f,ys as g,D as h,_s as t,ge as u,bs as v};
